<!DOCTYPE html>

<html>
<head>
<meta charset="utf-8">

<title>class OverviewController - Rails Application Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
</script>

<script src="./js/jquery.js"></script>
<script src="./js/darkfish.js"></script>

<link href="./css/fonts.css" rel="stylesheet">
<link href="./css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="./index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="./table_of_contents.html#pages">Pages</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    <div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  
  <p class="link"><a href="ApplicationController.html">ApplicationController</a>
  
</div>

    
    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li ><a href="#method-i-add_additional_info">#add_additional_info</a>
    
    <li ><a href="#method-i-clear_search">#clear_search</a>
    
    <li ><a href="#method-i-create_rework_info">#create_rework_info</a>
    
    <li ><a href="#method-i-eta_refresh">#eta_refresh</a>
    
    <li ><a href="#method-i-get_reasons">#get_reasons</a>
    
    <li ><a href="#method-i-get_steps">#get_steps</a>
    
    <li ><a href="#method-i-index">#index</a>
    
    <li ><a href="#method-i-merge_partial_with_parent">#merge_partial_with_parent</a>
    
    <li ><a href="#method-i-oops_mode">#oops_mode</a>
    
    <li ><a href="#method-i-open_confirm_modal">#open_confirm_modal</a>
    
    <li ><a href="#method-i-open_info_modal_l1">#open_info_modal_l1</a>
    
    <li ><a href="#method-i-open_info_modal_l2">#open_info_modal_l2</a>
    
    <li ><a href="#method-i-open_info_modal_l3">#open_info_modal_l3</a>
    
    <li ><a href="#method-i-open_rework_modal">#open_rework_modal</a>
    
    <li ><a href="#method-i-project_deatils_l1">#project_deatils_l1</a>
    
    <li ><a href="#method-i-project_deatils_l2">#project_deatils_l2</a>
    
    <li ><a href="#method-i-project_deatils_l3">#project_deatils_l3</a>
    
    <li ><a href="#method-i-recalculate_all_eta">#recalculate_all_eta</a>
    
    <li ><a href="#method-i-reject_reason_modal">#reject_reason_modal</a>
    
    <li ><a href="#method-i-save_reject_reason">#save_reject_reason</a>
    
    <li ><a href="#method-i-search">#search</a>
    
    <li ><a href="#method-i-show_all_db">#show_all_db</a>
    
    <li ><a href="#method-i-update_task_confirmation">#update_task_confirmation</a>
    
    <li ><a href="#method-i-update_workflow">#update_workflow</a>
    
    <li ><a href="#method-i-update_workflow_status">#update_workflow_status</a>
    
    <li ><a href="#method-i-workflow_update">#workflow_update</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-OverviewController">
  <h1 id="class-OverviewController" class="class">
    class OverviewController
  </h1>

  <section class="description">
    
  </section>

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-add_additional_info" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">add_additional_info</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <ul><li>
<p><strong>Description</strong> :</p>
<ul><li>
<p>It Create Additional Information for lxs object in database</p>
</li></ul>
</li></ul>
          
          

          
          <div class="method-source-code" id="add_additional_info-source">
            <pre><span class="ruby-comment"># File app/controllers/overview_controller.rb, line 279</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">add_additional_info</span>
   <span class="ruby-identifier">params</span>[<span class="ruby-value">:additional_info</span>][<span class="ruby-value">:info_timestamp</span>] = <span class="ruby-constant">L1</span>.<span class="ruby-identifier">set_db_datetime_format</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:additional_info</span>][<span class="ruby-value">:info_timestamp</span>])
   
   <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:additional_info</span>][<span class="ruby-value">:info_timestamp</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;&quot;</span>
     <span class="ruby-identifier">params</span>[<span class="ruby-value">:additional_info</span>][<span class="ruby-value">:info_timestamp</span>] = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%d/%m/%Y %H:%M&quot;</span>)
   <span class="ruby-keyword">end</span>

   <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:save_note_only</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;savenoteonly&#39;</span>
     <span class="ruby-constant">AdditionalInfo</span>.<span class="ruby-identifier">create</span>(<span class="ruby-identifier">additional_info_params_note_only</span>)
   
   <span class="ruby-keyword">else</span>

     <span class="ruby-identifier">codes</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:additional_info</span>][<span class="ruby-value">:reason_code_id</span>]
     <span class="ruby-keyword">if</span> <span class="ruby-identifier">codes</span>.<span class="ruby-identifier">present?</span>
       <span class="ruby-identifier">ids</span>  = <span class="ruby-string">&quot;&quot;</span>
       <span class="ruby-identifier">codes</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">d</span><span class="ruby-operator">|</span>
         <span class="ruby-identifier">ids</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">d</span> <span class="ruby-operator">+</span> <span class="ruby-string">&#39;,&#39;</span>
       <span class="ruby-keyword">end</span>
       <span class="ruby-identifier">ids</span>  = <span class="ruby-identifier">ids</span>.<span class="ruby-identifier">chop</span>
     <span class="ruby-keyword">end</span>
     <span class="ruby-identifier">add_info</span> = <span class="ruby-constant">AdditionalInfo</span>.<span class="ruby-identifier">create</span>(<span class="ruby-identifier">additional_info_params</span>)
     <span class="ruby-identifier">add_info</span>.<span class="ruby-identifier">update</span>(<span class="ruby-value">:reason_code_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ids</span>)
     <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:additional_info</span>][<span class="ruby-value">:object_type</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;L1&#39;</span>
       <span class="ruby-identifier">l1</span> = <span class="ruby-constant">L1</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:additional_info</span>][<span class="ruby-value">:object_id</span>])
       <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:additional_info</span>][<span class="ruby-value">:status</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">&#39;&#39;</span>
         <span class="ruby-identifier">l1</span>.<span class="ruby-identifier">update</span>(<span class="ruby-identifier">status</span><span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:additional_info</span>][<span class="ruby-value">:status</span>])
       <span class="ruby-keyword">end</span>
       <span class="ruby-keyword">if</span> <span class="ruby-identifier">l1</span>.<span class="ruby-identifier">status</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;cancel&#39;</span>
         <span class="ruby-constant">WorkflowLiveStep</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">object_type</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;L1&#39;</span>, <span class="ruby-identifier">object_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">l1</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">actual_confirmation</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>).<span class="ruby-identifier">update_all</span>(<span class="ruby-identifier">is_active</span><span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>)
  
         <span class="ruby-comment"># set childs to cancel        </span>
         <span class="ruby-identifier">l1</span>.<span class="ruby-identifier">l2s</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">l2</span><span class="ruby-operator">|</span>
           <span class="ruby-keyword">if</span> <span class="ruby-identifier">l2</span>.<span class="ruby-identifier">status</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&#39;cancel&#39;</span>
             <span class="ruby-constant">WorkflowLiveStep</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">object_type</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;L2&#39;</span>, <span class="ruby-identifier">object_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">l2</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">actual_confirmation</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>).<span class="ruby-identifier">update_all</span>(<span class="ruby-identifier">is_active</span><span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>)
             <span class="ruby-identifier">l2</span>.<span class="ruby-identifier">status</span> = <span class="ruby-string">&#39;cancel&#39;</span>
             <span class="ruby-identifier">l2</span>.<span class="ruby-identifier">save!</span>
             <span class="ruby-constant">AdditionalInfo</span>.<span class="ruby-identifier">create</span>(<span class="ruby-identifier">status</span><span class="ruby-operator">:</span> <span class="ruby-identifier">add_info</span>.<span class="ruby-identifier">status</span>, <span class="ruby-identifier">object_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">l2</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">object_type</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;L2&#39;</span>, <span class="ruby-identifier">info_timestamp</span><span class="ruby-operator">:</span> <span class="ruby-identifier">add_info</span>.<span class="ruby-identifier">info_timestamp</span>,
               <span class="ruby-identifier">work_flow_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">add_info</span>.<span class="ruby-identifier">work_flow_id</span>, <span class="ruby-identifier">note</span><span class="ruby-operator">:</span> <span class="ruby-identifier">add_info</span>.<span class="ruby-identifier">note</span>, <span class="ruby-identifier">user_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">add_info</span>.<span class="ruby-identifier">user_id</span>, <span class="ruby-identifier">reason_code_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">add_info</span>.<span class="ruby-identifier">reason_code_id</span>)
           <span class="ruby-keyword">end</span>
           <span class="ruby-identifier">l2</span>.<span class="ruby-identifier">l3s</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">l3</span><span class="ruby-operator">|</span>
             <span class="ruby-keyword">if</span> <span class="ruby-identifier">l3</span>.<span class="ruby-identifier">status</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&#39;cancel&#39;</span>
               <span class="ruby-constant">WorkflowLiveStep</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">object_type</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;L3&#39;</span>, <span class="ruby-identifier">object_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">l3</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">actual_confirmation</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>).<span class="ruby-identifier">update_all</span>(<span class="ruby-identifier">is_active</span><span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>)
               <span class="ruby-identifier">l3</span>.<span class="ruby-identifier">status</span> = <span class="ruby-string">&#39;cancel&#39;</span>
               <span class="ruby-keyword">if</span> <span class="ruby-identifier">l3</span>.<span class="ruby-identifier">rework_parent_id</span>.<span class="ruby-identifier">present?</span> <span class="ruby-keyword">and</span> <span class="ruby-operator">!</span><span class="ruby-identifier">l3</span>.<span class="ruby-identifier">is_main_record</span>
                 <span class="ruby-identifier">num_component_rework</span> = <span class="ruby-identifier">l3</span>.<span class="ruby-identifier">num_component</span>
                 <span class="ruby-identifier">parent_l3</span> = <span class="ruby-constant">L3</span>.<span class="ruby-identifier">find_by_id</span>(<span class="ruby-identifier">l3</span>.<span class="ruby-identifier">rework_parent_id</span>)
                 <span class="ruby-identifier">parent_l3</span>.<span class="ruby-identifier">num_component_in_rework</span> = <span class="ruby-identifier">parent_l3</span>.<span class="ruby-identifier">num_component_in_rework</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">num_component_rework</span>.<span class="ruby-identifier">to_i</span>
                 <span class="ruby-identifier">parent_l3</span>.<span class="ruby-identifier">save!</span>
               <span class="ruby-keyword">end</span>
               <span class="ruby-identifier">l3</span>.<span class="ruby-identifier">save!</span>
               <span class="ruby-constant">AdditionalInfo</span>.<span class="ruby-identifier">create</span>(<span class="ruby-identifier">status</span><span class="ruby-operator">:</span> <span class="ruby-identifier">add_info</span>.<span class="ruby-identifier">status</span>, <span class="ruby-identifier">object_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">l3</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">object_type</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;L3&#39;</span>, <span class="ruby-identifier">info_timestamp</span><span class="ruby-operator">:</span> <span class="ruby-identifier">add_info</span>.<span class="ruby-identifier">info_timestamp</span>,
                 <span class="ruby-identifier">work_flow_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">add_info</span>.<span class="ruby-identifier">work_flow_id</span>, <span class="ruby-identifier">note</span><span class="ruby-operator">:</span> <span class="ruby-identifier">add_info</span>.<span class="ruby-identifier">note</span>, <span class="ruby-identifier">user_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">add_info</span>.<span class="ruby-identifier">user_id</span>, <span class="ruby-identifier">reason_code_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">add_info</span>.<span class="ruby-identifier">reason_code_id</span>)
             <span class="ruby-keyword">end</span>
           <span class="ruby-keyword">end</span> 
         <span class="ruby-keyword">end</span>
       <span class="ruby-keyword">else</span>
         <span class="ruby-constant">WorkflowLiveStep</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">object_type</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;L1&#39;</span>, <span class="ruby-identifier">object_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">l1</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">actual_confirmation</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>).<span class="ruby-identifier">update_all</span>(<span class="ruby-identifier">is_active</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>)
       <span class="ruby-keyword">end</span>
     <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:additional_info</span>][<span class="ruby-value">:object_type</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;L2&#39;</span>
        <span class="ruby-identifier">l2</span> = <span class="ruby-constant">L2</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:additional_info</span>][<span class="ruby-value">:object_id</span>])
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:additional_info</span>][<span class="ruby-value">:status</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">&#39;&#39;</span>
           <span class="ruby-identifier">l2</span>.<span class="ruby-identifier">update</span>(<span class="ruby-identifier">status</span><span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:additional_info</span>][<span class="ruby-value">:status</span>])
        <span class="ruby-keyword">end</span>   
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">l2</span>.<span class="ruby-identifier">status</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;cancel&#39;</span>
           <span class="ruby-constant">WorkflowLiveStep</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">object_type</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;L2&#39;</span>, <span class="ruby-identifier">object_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">l2</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">actual_confirmation</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>).<span class="ruby-identifier">update_all</span>(<span class="ruby-identifier">is_active</span><span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>)
           <span class="ruby-identifier">l2</span>.<span class="ruby-identifier">l3s</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">l3</span><span class="ruby-operator">|</span>
             <span class="ruby-keyword">if</span> <span class="ruby-identifier">l3</span>.<span class="ruby-identifier">status</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&#39;cancel&#39;</span>
               <span class="ruby-constant">WorkflowLiveStep</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">object_type</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;L3&#39;</span>, <span class="ruby-identifier">object_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">l3</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">actual_confirmation</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>).<span class="ruby-identifier">update_all</span>(<span class="ruby-identifier">is_active</span><span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>)
               <span class="ruby-identifier">l3</span>.<span class="ruby-identifier">status</span> = <span class="ruby-string">&#39;cancel&#39;</span>
               <span class="ruby-keyword">if</span> <span class="ruby-identifier">l3</span>.<span class="ruby-identifier">rework_parent_id</span>.<span class="ruby-identifier">present?</span> <span class="ruby-keyword">and</span> <span class="ruby-operator">!</span><span class="ruby-identifier">l3</span>.<span class="ruby-identifier">is_main_record</span>
                 <span class="ruby-identifier">num_component_rework</span> = <span class="ruby-identifier">l3</span>.<span class="ruby-identifier">num_component</span>
                 <span class="ruby-identifier">parent_l3</span> = <span class="ruby-constant">L3</span>.<span class="ruby-identifier">find_by_id</span>(<span class="ruby-identifier">l3</span>.<span class="ruby-identifier">rework_parent_id</span>)
                 <span class="ruby-identifier">parent_l3</span>.<span class="ruby-identifier">num_component_in_rework</span> = <span class="ruby-identifier">parent_l3</span>.<span class="ruby-identifier">num_component_in_rework</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">num_component_rework</span>.<span class="ruby-identifier">to_i</span>
                 <span class="ruby-identifier">parent_l3</span>.<span class="ruby-identifier">save!</span>
               <span class="ruby-keyword">end</span>
               <span class="ruby-identifier">l3</span>.<span class="ruby-identifier">save!</span>
               <span class="ruby-constant">AdditionalInfo</span>.<span class="ruby-identifier">create</span>(<span class="ruby-identifier">status</span><span class="ruby-operator">:</span> <span class="ruby-identifier">add_info</span>.<span class="ruby-identifier">status</span>, <span class="ruby-identifier">object_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">l3</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">object_type</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;L3&#39;</span>, <span class="ruby-identifier">info_timestamp</span><span class="ruby-operator">:</span> <span class="ruby-identifier">add_info</span>.<span class="ruby-identifier">info_timestamp</span>,
                 <span class="ruby-identifier">work_flow_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">add_info</span>.<span class="ruby-identifier">work_flow_id</span>, <span class="ruby-identifier">note</span><span class="ruby-operator">:</span> <span class="ruby-identifier">add_info</span>.<span class="ruby-identifier">note</span>, <span class="ruby-identifier">user_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">add_info</span>.<span class="ruby-identifier">user_id</span>, <span class="ruby-identifier">reason_code_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">add_info</span>.<span class="ruby-identifier">reason_code_id</span>)
             <span class="ruby-keyword">end</span>
           <span class="ruby-keyword">end</span> 
        <span class="ruby-keyword">else</span>
          <span class="ruby-constant">WorkflowLiveStep</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">object_type</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;L2&#39;</span>, <span class="ruby-identifier">object_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">l2</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">actual_confirmation</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>).<span class="ruby-identifier">update_all</span>(<span class="ruby-identifier">is_active</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>)
        <span class="ruby-keyword">end</span>
     <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:additional_info</span>][<span class="ruby-value">:object_type</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;L3&#39;</span>
        <span class="ruby-identifier">l3</span> = <span class="ruby-constant">L3</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:additional_info</span>][<span class="ruby-value">:object_id</span>])
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:additional_info</span>][<span class="ruby-value">:status</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">&#39;&#39;</span>
           <span class="ruby-identifier">l3</span>.<span class="ruby-identifier">update</span>(<span class="ruby-identifier">status</span><span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:additional_info</span>][<span class="ruby-value">:status</span>])
        <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">l3</span>.<span class="ruby-identifier">status</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;cancel&#39;</span>
           <span class="ruby-keyword">if</span> <span class="ruby-identifier">l3</span>.<span class="ruby-identifier">rework_parent_id</span>.<span class="ruby-identifier">present?</span> <span class="ruby-keyword">and</span> <span class="ruby-operator">!</span><span class="ruby-identifier">l3</span>.<span class="ruby-identifier">is_main_record</span>
             <span class="ruby-identifier">num_component_rework</span> = <span class="ruby-identifier">l3</span>.<span class="ruby-identifier">num_component</span>
             <span class="ruby-identifier">parent_l3</span> = <span class="ruby-constant">L3</span>.<span class="ruby-identifier">find_by_id</span>(<span class="ruby-identifier">l3</span>.<span class="ruby-identifier">rework_parent_id</span>)
             <span class="ruby-identifier">parent_l3</span>.<span class="ruby-identifier">num_component_in_rework</span> = <span class="ruby-identifier">parent_l3</span>.<span class="ruby-identifier">num_component_in_rework</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">num_component_rework</span>.<span class="ruby-identifier">to_i</span>
             <span class="ruby-identifier">parent_l3</span>.<span class="ruby-identifier">save!</span>

             <span class="ruby-identifier">workflowLiveStep</span> = <span class="ruby-constant">WorkflowLiveStep</span>.<span class="ruby-identifier">find_by_object_type_and_object_id</span>(<span class="ruby-string">&#39;L3&#39;</span>, <span class="ruby-identifier">l3</span>.<span class="ruby-identifier">id</span>)
             <span class="ruby-keyword">if</span> <span class="ruby-identifier">workflowLiveStep</span>.<span class="ruby-identifier">present?</span>
               <span class="ruby-constant">WorkflowLiveStep</span>.<span class="ruby-identifier">get_steps_calculate_eta</span>(<span class="ruby-identifier">workflowLiveStep</span>, <span class="ruby-ivar">@workflow</span>,<span class="ruby-identifier">current_user</span>)
             <span class="ruby-keyword">end</span>
           <span class="ruby-keyword">end</span>
           <span class="ruby-constant">WorkflowLiveStep</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">object_type</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;L3&#39;</span>, <span class="ruby-identifier">object_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">l3</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">actual_confirmation</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>).<span class="ruby-identifier">update_all</span>(<span class="ruby-identifier">is_active</span><span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>)
        <span class="ruby-keyword">else</span>
           <span class="ruby-constant">WorkflowLiveStep</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">object_type</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;L3&#39;</span>, <span class="ruby-identifier">object_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">l3</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">actual_confirmation</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>).<span class="ruby-identifier">update_all</span>(<span class="ruby-identifier">is_active</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>)
        <span class="ruby-keyword">end</span>
     <span class="ruby-keyword">end</span>
   <span class="ruby-keyword">end</span>

   <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:report_info</span>].<span class="ruby-identifier">present?</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:report_info</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;report_info&#39;</span>
     <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
       <span class="ruby-identifier">format</span>.<span class="ruby-identifier">json</span> { <span class="ruby-identifier">render</span> <span class="ruby-identifier">json</span><span class="ruby-operator">:</span> {<span class="ruby-identifier">status</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;success&#39;</span>, <span class="ruby-identifier">message</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;Note added successfully&#39;</span>, <span class="ruby-identifier">report_info</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;report_info&#39;</span>}, <span class="ruby-identifier">status</span><span class="ruby-operator">:</span> <span class="ruby-value">200</span> }
     <span class="ruby-keyword">end</span>
   <span class="ruby-keyword">else</span>
     <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">root_path</span>, <span class="ruby-identifier">notice</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;Additional Info was successfully created.&#39;</span>
   <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-clear_search" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">clear_search</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <ul><li>
<p><strong>Description</strong> :</p>
<ul><li>
<p>It clears search reults from search panel and  gets all data of lxs objects
and render pop-up via clear_search.js.erb</p>
</li></ul>
</li></ul>
          
          

          
          <div class="method-source-code" id="clear_search-source">
            <pre><span class="ruby-comment"># File app/controllers/overview_controller.rb, line 1072</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">clear_search</span>
  <span class="ruby-identifier">session</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:q_string</span>)
  <span class="ruby-identifier">session</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:wildcard</span>)
  <span class="ruby-identifier">session</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:exact</span>)
  <span class="ruby-identifier">session</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:filter_object_id</span>)
  <span class="ruby-identifier">session</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:filter_object_type</span>)
  <span class="ruby-identifier">session</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:include_canceled</span>)
  <span class="ruby-identifier">session</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:include_completed</span>)
  <span class="ruby-ivar">@label_attributes</span> = <span class="ruby-ivar">@workflow</span>.<span class="ruby-identifier">label_attributes</span>.<span class="ruby-identifier">order</span>(<span class="ruby-value">:sequence</span>) <span class="ruby-comment">#.where(is_visible: true)</span>
  <span class="ruby-ivar">@workflow_stations</span> = <span class="ruby-ivar">@workflow</span>.<span class="ruby-identifier">workflow_stations</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">is_visible</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>).<span class="ruby-identifier">order</span>(<span class="ruby-value">:sequence</span>)
  <span class="ruby-ivar">@workflows</span> = <span class="ruby-constant">WorkFlow</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">is_active</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>, <span class="ruby-identifier">is_in_use</span><span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>)
  <span class="ruby-ivar">@l1s</span> = <span class="ruby-ivar">@workflow</span>.<span class="ruby-identifier">l1s</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">status</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;Active&#39;</span>).<span class="ruby-identifier">order</span>(<span class="ruby-value">:id</span>)
  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>
  <span class="ruby-keyword">end</span> 

<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-create_rework_info" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">create_rework_info</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <ul><li>
<p><strong>Description</strong> :</p>
<ul><li>
<p>It creates a Full or Partial Rework for l3s based upon no of Components and
respective Additional Information and logs every Actual Confirmation and
ETA into Timestamp_Logs table</p>
</li></ul>
</li></ul>
          
          

          
          <div class="method-source-code" id="create_rework_info-source">
            <pre><span class="ruby-comment"># File app/controllers/overview_controller.rb, line 500</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">create_rework_info</span>
  <span class="ruby-identifier">merge_back_partial_with_parent</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:merge_back_partial_with_parent</span>]
  <span class="ruby-identifier">rework_object_type</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:rework_info</span>][<span class="ruby-value">:object_type</span>]
  <span class="ruby-identifier">rework_date_time</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:rework_date_time</span>]

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">merge_back_partial_with_parent</span>.<span class="ruby-identifier">present?</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">merge_back_partial_with_parent</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;merge_back_partial_with_parent&quot;</span>
    <span class="ruby-identifier">partial_to_merge_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:partial_to_merge_id</span>]
    <span class="ruby-identifier">merge_partial_with_parent</span>(<span class="ruby-identifier">partial_to_merge_id</span>, <span class="ruby-identifier">rework_object_type</span>, <span class="ruby-identifier">rework_date_time</span>)
  <span class="ruby-keyword">else</span>  
   <span class="ruby-identifier">mew_rework_info_object</span> = <span class="ruby-constant">ReworkInfo</span>.<span class="ruby-identifier">create</span>(<span class="ruby-identifier">rework_info_params</span>)
   
   <span class="ruby-identifier">reset_type</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:reset_type</span>]
   <span class="ruby-identifier">move_original_record_back_to_step</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:move_original_record_back_to_step</span>]
   <span class="ruby-identifier">rework_parent_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:rework_parent_id</span>]
   <span class="ruby-identifier">parent_total_num_component</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:num_component</span>]
   <span class="ruby-identifier">num_component_in_rework</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:num_component_in_rework</span>]
   <span class="ruby-identifier">component_already_in_rework</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:component_already_in_rework</span>]
   <span class="ruby-identifier">rework_start_step</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:rework_start_step</span>]
   <span class="ruby-identifier">component_already_in_rework</span> = <span class="ruby-identifier">component_already_in_rework</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">component_already_in_rework</span> <span class="ruby-operator">:</span> <span class="ruby-value">0</span>
   <span class="ruby-identifier">remaining_parent_component</span> = <span class="ruby-identifier">parent_total_num_component</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">num_component_in_rework</span>.<span class="ruby-identifier">to_i</span>

   <span class="ruby-comment"># find parent of rework</span>
   <span class="ruby-identifier">l3_object</span> = <span class="ruby-constant">L3</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">rework_parent_id</span>)
   <span class="ruby-identifier">l3_rework_name</span> = <span class="ruby-identifier">get_rework_name</span>(<span class="ruby-identifier">l3_object</span>.<span class="ruby-identifier">name</span>)
   <span class="ruby-identifier">l3_object</span>.<span class="ruby-identifier">num_component_in_rework</span> = <span class="ruby-identifier">num_component_in_rework</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">component_already_in_rework</span>.<span class="ruby-identifier">to_i</span>

   <span class="ruby-comment"># create new rework</span>
   <span class="ruby-identifier">l3_rework</span> = <span class="ruby-constant">L3</span>.<span class="ruby-identifier">new</span>
   <span class="ruby-identifier">l3_rework</span>.<span class="ruby-identifier">user_id</span> = <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">id</span>
   <span class="ruby-identifier">l3_rework</span>.<span class="ruby-identifier">name</span> = <span class="ruby-identifier">l3_rework_name</span>
   <span class="ruby-identifier">l3_rework</span>.<span class="ruby-identifier">status</span> = <span class="ruby-string">&#39;Active&#39;</span>
   <span class="ruby-identifier">l3_rework</span>.<span class="ruby-identifier">business_unit</span> = <span class="ruby-identifier">l3_object</span>.<span class="ruby-identifier">business_unit</span>
   <span class="ruby-identifier">l3_rework</span>.<span class="ruby-identifier">l2_id</span> = <span class="ruby-identifier">l3_object</span>.<span class="ruby-identifier">l2_id</span>
   <span class="ruby-identifier">l3_rework</span>.<span class="ruby-identifier">rework_parent_id</span> = <span class="ruby-identifier">rework_parent_id</span>
   <span class="ruby-identifier">l3_rework</span>.<span class="ruby-identifier">num_component</span> = <span class="ruby-identifier">num_component_in_rework</span>
   <span class="ruby-identifier">reason</span> = <span class="ruby-constant">ReasonCode</span>.<span class="ruby-identifier">find_by_recording_level</span>(<span class="ruby-string">&#39;ReworkParent&#39;</span>)
   <span class="ruby-identifier">reason_id</span> = <span class="ruby-identifier">reason</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">reason</span>.<span class="ruby-identifier">id</span> <span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>

   <span class="ruby-comment"># -----------------if fulllllllllllllll Rework</span>
   <span class="ruby-keyword">if</span> <span class="ruby-identifier">parent_total_num_component</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">num_component_in_rework</span>.<span class="ruby-identifier">to_i</span>
    <span class="ruby-identifier">l3_object</span>.<span class="ruby-identifier">is_full_rework</span> = <span class="ruby-keyword">true</span>
    <span class="ruby-identifier">l3_object</span>.<span class="ruby-identifier">is_closed</span> = <span class="ruby-keyword">true</span>
    <span class="ruby-identifier">l3_object</span>.<span class="ruby-identifier">status</span> = <span class="ruby-string">&#39;Closed&#39;</span>
    <span class="ruby-identifier">l3_rework</span>.<span class="ruby-identifier">is_main_record</span> = <span class="ruby-identifier">l3_object</span>.<span class="ruby-identifier">is_main_record</span>
    <span class="ruby-identifier">l3_object</span>.<span class="ruby-identifier">is_main_record</span> = <span class="ruby-keyword">false</span>
    <span class="ruby-identifier">l3_rework</span>.<span class="ruby-identifier">merge_back_with_id</span> = <span class="ruby-identifier">l3_object</span>.<span class="ruby-identifier">merge_back_with_id</span>
    <span class="ruby-identifier">l3_object</span>.<span class="ruby-identifier">merge_back_with_id</span> = <span class="ruby-keyword">nil</span>
      
    <span class="ruby-constant">AdditionalInfo</span>.<span class="ruby-identifier">create</span>(<span class="ruby-identifier">info_timestamp</span><span class="ruby-operator">:</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span> ,<span class="ruby-identifier">object_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">l3_object</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">object_type</span><span class="ruby-operator">:</span> <span class="ruby-identifier">rework_object_type</span>, 
      <span class="ruby-identifier">status</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;Closed&#39;</span>, <span class="ruby-identifier">reason_code_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">reason_id</span>, <span class="ruby-identifier">work_flow_id</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@workflow</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">user_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">id</span>)

    <span class="ruby-constant">WorkflowLiveStep</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">object_type</span><span class="ruby-operator">:</span> <span class="ruby-identifier">rework_object_type</span>, <span class="ruby-identifier">object_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">rework_parent_id</span>, <span class="ruby-identifier">actual_confirmation</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>).<span class="ruby-identifier">update_all</span>(<span class="ruby-identifier">is_active</span><span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>)
   
    <span class="ruby-comment"># -----------------else Partial Rework-------------------</span>
   <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">num_component_in_rework</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">parent_total_num_component</span>.<span class="ruby-identifier">to_i</span>
    <span class="ruby-identifier">rework_type</span> = <span class="ruby-string">&#39;partial_rework&#39;</span> 


    <span class="ruby-identifier">l3_rework</span>.<span class="ruby-identifier">merge_back_with_id</span> = <span class="ruby-identifier">rework_parent_id</span>  

   <span class="ruby-keyword">end</span>

   <span class="ruby-identifier">l3_object</span>.<span class="ruby-identifier">save!</span>
   <span class="ruby-keyword">if</span> <span class="ruby-identifier">l3_rework</span>.<span class="ruby-identifier">save!</span>
       <span class="ruby-comment"># create archive info of new rework</span>
      <span class="ruby-constant">AdditionalInfo</span>.<span class="ruby-identifier">create</span>(<span class="ruby-identifier">info_timestamp</span><span class="ruby-operator">:</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span> ,<span class="ruby-identifier">object_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">l3_rework</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">object_type</span><span class="ruby-operator">:</span> <span class="ruby-identifier">rework_object_type</span>, 
      <span class="ruby-identifier">status</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;Active&#39;</span>, <span class="ruby-identifier">work_flow_id</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@workflow</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">user_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">id</span>)

      <span class="ruby-identifier">start_workflow_live_step</span> = <span class="ruby-constant">WorkflowLiveStep</span>.<span class="ruby-identifier">find_by_station_step_id_and_object_id_and_object_type</span>(<span class="ruby-identifier">rework_start_step</span>,<span class="ruby-identifier">rework_parent_id</span>, <span class="ruby-identifier">rework_object_type</span>)
      <span class="ruby-identifier">mew_rework_info_object</span>.<span class="ruby-identifier">new_rework_id</span> = <span class="ruby-identifier">l3_rework</span>.<span class="ruby-identifier">id</span>
      <span class="ruby-identifier">mew_rework_info_object</span>.<span class="ruby-identifier">new_rework_type</span> = <span class="ruby-identifier">rework_object_type</span>

      <span class="ruby-comment"># save reset type and back record if partial rework and move original record back to selected</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">move_original_record_back_to_step</span>.<span class="ruby-identifier">present?</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">parent_total_num_component</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">num_component_in_rework</span>.<span class="ruby-identifier">to_i</span>
        <span class="ruby-identifier">mew_rework_info_object</span>.<span class="ruby-identifier">move_original_record_back_to_step</span> = <span class="ruby-identifier">move_original_record_back_to_step</span>
        <span class="ruby-identifier">mew_rework_info_object</span>.<span class="ruby-identifier">reset_type</span> = <span class="ruby-identifier">reset_type</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">mew_rework_info_object</span>.<span class="ruby-identifier">rework_start_step</span> = <span class="ruby-identifier">start_workflow_live_step</span>.<span class="ruby-identifier">id</span>
      <span class="ruby-identifier">mew_rework_info_object</span>.<span class="ruby-identifier">save!</span>

      <span class="ruby-comment"># copy all parent attributes to new rewwork </span>
      <span class="ruby-identifier">parent_lang_attribute_values</span> = <span class="ruby-identifier">l3_object</span>.<span class="ruby-identifier">attribute_values</span>
      <span class="ruby-identifier">parent_lang_attribute_values</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">lang_attributeValue</span><span class="ruby-operator">|</span>
        <span class="ruby-constant">AttributeValue</span>.<span class="ruby-identifier">create</span>(<span class="ruby-identifier">label_attribute_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">lang_attributeValue</span>.<span class="ruby-identifier">label_attribute_id</span>,<span class="ruby-identifier">value</span><span class="ruby-operator">:</span> <span class="ruby-identifier">lang_attributeValue</span>.<span class="ruby-identifier">value</span>,
          <span class="ruby-identifier">object_type</span><span class="ruby-operator">:</span> <span class="ruby-identifier">lang_attributeValue</span>.<span class="ruby-identifier">object_type</span>, <span class="ruby-identifier">object_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">l3_rework</span>.<span class="ruby-identifier">id</span>)
      <span class="ruby-keyword">end</span>

      <span class="ruby-comment"># change Actual confirmation and log timestap if partial rework and move original record back to selected</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">move_original_record_back_to_step</span>.<span class="ruby-identifier">present?</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">parent_total_num_component</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">num_component_in_rework</span>.<span class="ruby-identifier">to_i</span>
        <span class="ruby-identifier">noOf_comp</span> = <span class="ruby-identifier">l3_object</span>.<span class="ruby-identifier">num_component</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">l3_object</span>.<span class="ruby-identifier">num_component_in_rework</span>.<span class="ruby-identifier">to_i</span>
        <span class="ruby-identifier">no_of_lang_comp</span> = <span class="ruby-identifier">l3_object</span>.<span class="ruby-identifier">attribute_values</span>.<span class="ruby-identifier">joins</span>(<span class="ruby-value">:label_attribute</span>).<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;label_attributes.short_label=&#39;#Lang&#39;&quot;</span>).<span class="ruby-identifier">first</span>
        
        <span class="ruby-comment"># change actual confirmation</span>
        <span class="ruby-identifier">actual_confirmation</span> = <span class="ruby-constant">L1</span>.<span class="ruby-identifier">set_db_datetime_format</span>(<span class="ruby-identifier">rework_date_time</span>)
        <span class="ruby-identifier">original_record_backTO_live_step</span> = <span class="ruby-constant">WorkflowLiveStep</span>.<span class="ruby-identifier">find_by_station_step_id_and_object_id_and_object_type</span>(<span class="ruby-identifier">move_original_record_back_to_step</span>.<span class="ruby-identifier">to_i</span>,<span class="ruby-identifier">rework_parent_id</span>, <span class="ruby-identifier">rework_object_type</span>)
        <span class="ruby-identifier">original_record_backTO_live_step</span>.<span class="ruby-identifier">actual_confirmation</span> = <span class="ruby-identifier">actual_confirmation</span>
        <span class="ruby-identifier">original_record_backTO_live_step</span>.<span class="ruby-identifier">save!</span>
        
        <span class="ruby-comment"># save timestamp log</span>
         <span class="ruby-constant">TimestampLog</span>.<span class="ruby-identifier">create</span>(<span class="ruby-identifier">workflow_live_step_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">original_record_backTO_live_step</span>.<span class="ruby-identifier">id</span>,
                          <span class="ruby-identifier">actual_confirmation</span><span class="ruby-operator">:</span> <span class="ruby-identifier">actual_confirmation</span>,
                          <span class="ruby-identifier">user_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">id</span>,
                          <span class="ruby-identifier">work_flow_id</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@workflow</span>.<span class="ruby-identifier">id</span>,
                          <span class="ruby-identifier">no_of_comp</span><span class="ruby-operator">:</span> <span class="ruby-identifier">noOf_comp</span>,
                          <span class="ruby-identifier">no_of_lang</span><span class="ruby-operator">:</span> <span class="ruby-identifier">no_of_lang_comp</span>)

      <span class="ruby-keyword">else</span>
         <span class="ruby-identifier">original_record_backTO_live_step</span> = <span class="ruby-keyword">nil</span>
      <span class="ruby-keyword">end</span>

      <span class="ruby-comment"># copy parent live steps for new rework</span>
      <span class="ruby-identifier">live_steps_new_rework_object</span> = <span class="ruby-keyword">nil</span>
      <span class="ruby-identifier">rework_live_steps</span> = <span class="ruby-constant">WorkflowLiveStep</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">object_type</span><span class="ruby-operator">:</span> <span class="ruby-identifier">rework_object_type</span>, <span class="ruby-identifier">object_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">rework_parent_id</span>)
      <span class="ruby-identifier">rework_live_steps</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">original_rework</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">live_steps_new_rework</span> = <span class="ruby-constant">WorkflowLiveStep</span>.<span class="ruby-identifier">new</span>
        <span class="ruby-identifier">live_steps_new_rework</span>.<span class="ruby-identifier">station_step_id</span> = <span class="ruby-identifier">original_rework</span>.<span class="ruby-identifier">station_step_id</span>
        <span class="ruby-identifier">live_steps_new_rework</span>.<span class="ruby-identifier">object_id</span> = <span class="ruby-identifier">l3_rework</span>.<span class="ruby-identifier">id</span>
        <span class="ruby-identifier">live_steps_new_rework</span>.<span class="ruby-identifier">object_type</span> = <span class="ruby-identifier">original_rework</span>.<span class="ruby-identifier">object_type</span>
        <span class="ruby-identifier">live_steps_new_rework</span>.<span class="ruby-identifier">predecessors</span> = <span class="ruby-identifier">original_rework</span>.<span class="ruby-identifier">predecessors</span>
        <span class="ruby-identifier">live_steps_new_rework</span>.<span class="ruby-identifier">step_completion</span> = <span class="ruby-identifier">original_rework</span>.<span class="ruby-identifier">step_completion</span>
        <span class="ruby-identifier">live_steps_new_rework</span>.<span class="ruby-identifier">eta</span> = <span class="ruby-identifier">original_rework</span>.<span class="ruby-identifier">eta</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">original_rework</span>.<span class="ruby-identifier">id</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-identifier">start_workflow_live_step</span>.<span class="ruby-identifier">id</span>
          <span class="ruby-identifier">live_steps_new_rework</span>.<span class="ruby-identifier">is_active</span> = <span class="ruby-keyword">true</span>
        <span class="ruby-keyword">else</span>
          <span class="ruby-identifier">live_steps_new_rework</span>.<span class="ruby-identifier">is_active</span> = <span class="ruby-keyword">false</span>
        <span class="ruby-keyword">end</span>

        <span class="ruby-comment"># reset the confirmation of parent record on the basis of RESET FILTER </span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">parent_total_num_component</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">num_component_in_rework</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">original_record_backTO_live_step</span>.<span class="ruby-identifier">present?</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">reset_type</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;keep_all&#39;</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">original_rework</span>.<span class="ruby-identifier">id</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">original_record_backTO_live_step</span>.<span class="ruby-identifier">id</span>
            <span class="ruby-identifier">original_rework</span>.<span class="ruby-identifier">actual_confirmation</span> = <span class="ruby-identifier">original_rework</span>.<span class="ruby-identifier">actual_confirmation</span>
          <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">reset_type</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;reset_all&#39;</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">original_rework</span>.<span class="ruby-identifier">id</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">original_record_backTO_live_step</span>.<span class="ruby-identifier">id</span>
            <span class="ruby-identifier">original_rework</span>.<span class="ruby-identifier">actual_confirmation</span> = <span class="ruby-keyword">nil</span>
          <span class="ruby-keyword">end</span>
          <span class="ruby-identifier">original_rework</span>.<span class="ruby-identifier">save!</span>
        <span class="ruby-keyword">end</span>

        <span class="ruby-keyword">if</span> <span class="ruby-identifier">live_steps_new_rework</span>.<span class="ruby-identifier">save!</span>
          <span class="ruby-comment"># save timestamp log</span>
          <span class="ruby-comment"># numberOfLangComp = 0</span>
          <span class="ruby-comment"># noOfLangComp = l3_rework.attribute_values.joins(:label_attribute).where(&quot;label_attributes.short_label=&#39;#Lang&#39;&quot;).first</span>
          <span class="ruby-comment"># if noOfLangComp.present?</span>
          <span class="ruby-comment">#   numberOfLangComp = noOfLangComp.value</span>
          <span class="ruby-comment"># end</span>
          <span class="ruby-comment"># TimestampLog.create(workflow_live_step_id: live_steps_new_rework.id,</span>
          <span class="ruby-comment">#                 actual_confirmation: live_steps_new_rework.actual_confirmation,</span>
          <span class="ruby-comment">#                 user_id: current_user.id,</span>
          <span class="ruby-comment">#                 work_flow_id: @workflow.id,</span>
          <span class="ruby-comment">#                 no_of_comp: l3_rework.num_component,</span>
          <span class="ruby-comment">#                 no_of_lang: numberOfLangComp)</span>

          <span class="ruby-identifier">predecessor</span> = <span class="ruby-identifier">live_steps_new_rework</span>.<span class="ruby-identifier">predecessors</span>
          <span class="ruby-identifier">step_predecessor</span> = <span class="ruby-constant">WorkflowLiveStep</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;id in (#{predecessor})&quot;</span>)
          <span class="ruby-identifier">predecessor_list</span> = <span class="ruby-string">&#39;&#39;</span>
          <span class="ruby-identifier">step_predecessor</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">st_pred</span><span class="ruby-operator">|</span>
            <span class="ruby-identifier">station_stepID</span> = <span class="ruby-identifier">st_pred</span>.<span class="ruby-identifier">station_step_id</span>
            <span class="ruby-identifier">start_workflow_liveStep</span> = <span class="ruby-constant">WorkflowLiveStep</span>.<span class="ruby-identifier">find_by_station_step_id_and_object_id_and_object_type</span>(<span class="ruby-identifier">station_stepID</span>,<span class="ruby-identifier">l3_rework</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">rework_object_type</span>)
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">start_workflow_liveStep</span>.<span class="ruby-identifier">present?</span>
              <span class="ruby-identifier">predecessor_list</span> = <span class="ruby-identifier">predecessor_list</span><span class="ruby-operator">+</span><span class="ruby-string">&#39;,&#39;</span><span class="ruby-operator">+</span><span class="ruby-identifier">start_workflow_liveStep</span>.<span class="ruby-identifier">id</span>.<span class="ruby-identifier">to_s</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">predecessor_list</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&#39;&#39;</span>
            <span class="ruby-identifier">predecessor_list</span>.<span class="ruby-identifier">slice!</span>(<span class="ruby-value">0</span>)
            <span class="ruby-identifier">live_steps_new_rework</span>.<span class="ruby-identifier">predecessors</span> = <span class="ruby-identifier">predecessor_list</span>
            <span class="ruby-identifier">live_steps_new_rework</span>.<span class="ruby-identifier">save!</span>
          <span class="ruby-keyword">end</span>

          <span class="ruby-identifier">live_steps_new_rework_object</span> = <span class="ruby-identifier">live_steps_new_rework</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>

      <span class="ruby-comment">#-----------------------start mising predecessors L2</span>
      <span class="ruby-ivar">@l3</span> = <span class="ruby-identifier">l3_object</span> 
      <span class="ruby-identifier">workflow_live_steps_empty_pred</span> = <span class="ruby-constant">WorkflowLiveStep</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">object_id</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@l3</span>.<span class="ruby-identifier">l2</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">object_type</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;L2&#39;</span>)
      <span class="ruby-identifier">workflow_live_steps_empty_pred</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">pred_stp</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">predecessors</span> = <span class="ruby-constant">Transition</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">station_step_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">pred_stp</span>.<span class="ruby-identifier">station_step_id</span>)
        <span class="ruby-identifier">predecessors_step_empty</span> = <span class="ruby-string">&#39;&#39;</span>
        <span class="ruby-identifier">workflow_live_steps_pred</span> = []
        <span class="ruby-identifier">predecessors</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">pred</span><span class="ruby-operator">|</span>
          <span class="ruby-identifier">workflow_live_steps_pred_l1</span> = <span class="ruby-constant">WorkflowLiveStep</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">station_step_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">pred</span>.<span class="ruby-identifier">previous_station_step_id</span>, <span class="ruby-identifier">object_id</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@l3</span>.<span class="ruby-identifier">l2</span>.<span class="ruby-identifier">l1</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">object_type</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;L1&#39;</span>)
          <span class="ruby-identifier">workflow_live_steps_pred_l1</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">wlsp_l1</span><span class="ruby-operator">|</span>
            <span class="ruby-identifier">workflow_live_steps_pred</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">wlsp_l1</span>
          <span class="ruby-keyword">end</span>

          <span class="ruby-comment">#@l3.l2.l1.l2s.each do |l1_l2|</span>
            <span class="ruby-identifier">workflow_live_steps_pred_l2</span> = <span class="ruby-constant">WorkflowLiveStep</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">station_step_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">pred</span>.<span class="ruby-identifier">previous_station_step_id</span>, <span class="ruby-identifier">object_id</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@l3</span>.<span class="ruby-identifier">l2</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">object_type</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;L2&#39;</span>)
            <span class="ruby-identifier">workflow_live_steps_pred_l2</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">wlsp_l2</span><span class="ruby-operator">|</span>
              <span class="ruby-identifier">workflow_live_steps_pred</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">wlsp_l2</span>
            <span class="ruby-keyword">end</span>

            <span class="ruby-ivar">@l3</span>.<span class="ruby-identifier">l2</span>.<span class="ruby-identifier">l3s</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">l2_l3</span><span class="ruby-operator">|</span>
              <span class="ruby-identifier">workflow_live_steps_pred_l3</span> = <span class="ruby-constant">WorkflowLiveStep</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">station_step_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">pred</span>.<span class="ruby-identifier">previous_station_step_id</span>, <span class="ruby-identifier">object_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">l2_l3</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">object_type</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;L3&#39;</span>)
              <span class="ruby-identifier">workflow_live_steps_pred_l3</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">wlsp_l3</span><span class="ruby-operator">|</span>
                <span class="ruby-identifier">workflow_live_steps_pred</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">wlsp_l3</span>
              <span class="ruby-keyword">end</span>

            <span class="ruby-keyword">end</span>
          <span class="ruby-comment">#end</span>

        <span class="ruby-keyword">end</span>
        <span class="ruby-identifier">workflow_live_steps_pred</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">wls</span><span class="ruby-operator">|</span>
          <span class="ruby-identifier">predecessors_step_empty</span> = <span class="ruby-identifier">predecessors_step_empty</span><span class="ruby-operator">+</span><span class="ruby-string">&#39;,&#39;</span><span class="ruby-operator">+</span><span class="ruby-identifier">wls</span>.<span class="ruby-identifier">id</span>.<span class="ruby-identifier">to_s</span>
        <span class="ruby-keyword">end</span>

        <span class="ruby-keyword">if</span> <span class="ruby-identifier">predecessors_step_empty</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&#39;&#39;</span>
          <span class="ruby-identifier">predecessors_step_empty</span>.<span class="ruby-identifier">slice!</span>(<span class="ruby-value">0</span>)
        <span class="ruby-keyword">end</span>
        <span class="ruby-identifier">pred_stp</span>.<span class="ruby-identifier">update</span>(<span class="ruby-identifier">predecessors</span><span class="ruby-operator">:</span> <span class="ruby-identifier">predecessors_step_empty</span>)
      <span class="ruby-keyword">end</span>

      <span class="ruby-comment">#-----------------------start mising predecessors for L1</span>
      <span class="ruby-identifier">workflow_live_steps_empty_pred</span> = <span class="ruby-constant">WorkflowLiveStep</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">object_id</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@l3</span>.<span class="ruby-identifier">l2</span>.<span class="ruby-identifier">l1</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">object_type</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;L1&#39;</span>)
      <span class="ruby-identifier">workflow_live_steps_empty_pred</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">pred_stp</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">predecessors</span> = <span class="ruby-constant">Transition</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">station_step_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">pred_stp</span>.<span class="ruby-identifier">station_step_id</span>)
        <span class="ruby-identifier">predecessors_step_empty</span> = <span class="ruby-string">&#39;&#39;</span>
        <span class="ruby-identifier">workflow_live_steps_pred</span> = []
        <span class="ruby-identifier">predecessors</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">pred</span><span class="ruby-operator">|</span>
          <span class="ruby-identifier">workflow_live_steps_pred_l1</span> = <span class="ruby-constant">WorkflowLiveStep</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">station_step_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">pred</span>.<span class="ruby-identifier">previous_station_step_id</span>, <span class="ruby-identifier">object_id</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@l3</span>.<span class="ruby-identifier">l2</span>.<span class="ruby-identifier">l1</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">object_type</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;L1&#39;</span>)
          <span class="ruby-identifier">workflow_live_steps_pred_l1</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">wlsp_l1</span><span class="ruby-operator">|</span>
            <span class="ruby-identifier">workflow_live_steps_pred</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">wlsp_l1</span>
          <span class="ruby-keyword">end</span>
          
          <span class="ruby-ivar">@l3</span>.<span class="ruby-identifier">l2</span>.<span class="ruby-identifier">l1</span>.<span class="ruby-identifier">l2s</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">l1_l2</span><span class="ruby-operator">|</span>
            <span class="ruby-identifier">workflow_live_steps_pred_l2</span> = <span class="ruby-constant">WorkflowLiveStep</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">station_step_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">pred</span>.<span class="ruby-identifier">previous_station_step_id</span>, <span class="ruby-identifier">object_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">l1_l2</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">object_type</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;L2&#39;</span>)
            <span class="ruby-identifier">workflow_live_steps_pred_l2</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">wlsp_l2</span><span class="ruby-operator">|</span>
              <span class="ruby-identifier">workflow_live_steps_pred</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">wlsp_l2</span>
            <span class="ruby-keyword">end</span>

            <span class="ruby-identifier">l1_l2</span>.<span class="ruby-identifier">l3s</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">l2_l3</span><span class="ruby-operator">|</span>
              <span class="ruby-identifier">workflow_live_steps_pred_l3</span> = <span class="ruby-constant">WorkflowLiveStep</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">station_step_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">pred</span>.<span class="ruby-identifier">previous_station_step_id</span>, <span class="ruby-identifier">object_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">l2_l3</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">object_type</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;L3&#39;</span>)
              <span class="ruby-identifier">workflow_live_steps_pred_l3</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">wlsp_l3</span><span class="ruby-operator">|</span>
                <span class="ruby-identifier">workflow_live_steps_pred</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">wlsp_l3</span>
              <span class="ruby-keyword">end</span>

            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>

        <span class="ruby-keyword">end</span>
        <span class="ruby-identifier">workflow_live_steps_pred</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">wls</span><span class="ruby-operator">|</span>
          <span class="ruby-identifier">predecessors_step_empty</span> = <span class="ruby-identifier">predecessors_step_empty</span><span class="ruby-operator">+</span><span class="ruby-string">&#39;,&#39;</span><span class="ruby-operator">+</span><span class="ruby-identifier">wls</span>.<span class="ruby-identifier">id</span>.<span class="ruby-identifier">to_s</span>
        <span class="ruby-keyword">end</span>

        <span class="ruby-keyword">if</span> <span class="ruby-identifier">predecessors_step_empty</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&#39;&#39;</span>
          <span class="ruby-identifier">predecessors_step_empty</span>.<span class="ruby-identifier">slice!</span>(<span class="ruby-value">0</span>)
        <span class="ruby-keyword">end</span>
        <span class="ruby-identifier">pred_stp</span>.<span class="ruby-identifier">update</span>(<span class="ruby-identifier">predecessors</span><span class="ruby-operator">:</span> <span class="ruby-identifier">predecessors_step_empty</span>)
      <span class="ruby-keyword">end</span>

      <span class="ruby-keyword">if</span> <span class="ruby-identifier">l3_rework</span>.<span class="ruby-identifier">workflow_live_steps</span>.<span class="ruby-identifier">present?</span>
       <span class="ruby-identifier">new_rework_first_object</span> = <span class="ruby-identifier">l3_rework</span>.<span class="ruby-identifier">workflow_live_steps</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">is_active</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>).<span class="ruby-identifier">first</span>
       <span class="ruby-identifier">actual_confirmation</span> = <span class="ruby-constant">L1</span>.<span class="ruby-identifier">set_db_datetime_format</span>(<span class="ruby-identifier">rework_date_time</span>)
       <span class="ruby-identifier">calculate_eta_completion</span>(<span class="ruby-identifier">actual_confirmation</span>, <span class="ruby-identifier">new_rework_first_object</span>)
      <span class="ruby-keyword">end</span>

   <span class="ruby-keyword">end</span>

   <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">root_path</span>, <span class="ruby-identifier">notice</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;Rework Info was successfully created.&#39;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-eta_refresh" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">eta_refresh</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <ul><li>
<p><strong>Description</strong> :</p>
<ul><li>
<p>It is called from within Additional Information pop-up for l1s to force
ETA-Refresh</p>
</li></ul>
</li></ul>
          
          

          
          <div class="method-source-code" id="eta_refresh-source">
            <pre><span class="ruby-comment"># File app/controllers/overview_controller.rb, line 138</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">eta_refresh</span>
 <span class="ruby-identifier">l1_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:l1_id</span>]
 <span class="ruby-identifier">workflowLiveStep</span> = <span class="ruby-constant">WorkflowLiveStep</span>.<span class="ruby-identifier">find_by_object_id_and_object_type</span>(<span class="ruby-identifier">l1_id</span>,<span class="ruby-string">&#39;L1&#39;</span>)

 <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">workflowLiveStep</span>.<span class="ruby-identifier">present?</span>
     <span class="ruby-identifier">l1</span> = <span class="ruby-constant">L1</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:l1_id</span>])

     <span class="ruby-keyword">if</span> <span class="ruby-identifier">l1</span>.<span class="ruby-identifier">l2s</span>.<span class="ruby-identifier">present?</span>
       <span class="ruby-identifier">l2</span> = <span class="ruby-identifier">l1</span>.<span class="ruby-identifier">l2s</span>.<span class="ruby-identifier">first</span>
       <span class="ruby-identifier">workflowLiveStep</span> = <span class="ruby-constant">WorkflowLiveStep</span>.<span class="ruby-identifier">find_by_object_id_and_object_type</span>(<span class="ruby-identifier">l2</span>.<span class="ruby-identifier">id</span>,<span class="ruby-string">&#39;L2&#39;</span>)
     <span class="ruby-keyword">end</span>

 <span class="ruby-keyword">end</span>

 <span class="ruby-keyword">if</span> <span class="ruby-identifier">workflowLiveStep</span>.<span class="ruby-identifier">present?</span>
   <span class="ruby-constant">WorkflowLiveStep</span>.<span class="ruby-identifier">get_steps_calculate_eta</span>(<span class="ruby-identifier">workflowLiveStep</span>, <span class="ruby-ivar">@workflow</span>,<span class="ruby-identifier">current_user</span>)
 <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">root_path</span>, <span class="ruby-identifier">notice</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;ETA\s refreshed successfully.&#39;</span>

<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-get_reasons" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_reasons</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <ul><li>
<p><strong>Description</strong> :</p>
<ul><li>
<p>It get reasons from database to be shown in Reason drop down option in
Rework Pop-up</p>
</li></ul>
</li></ul>
          
          

          
          <div class="method-source-code" id="get_reasons-source">
            <pre><span class="ruby-comment"># File app/controllers/overview_controller.rb, line 398</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_reasons</span>
  <span class="ruby-ivar">@reasons</span> = <span class="ruby-constant">ReasonCode</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">status</span><span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:additional_info</span>][<span class="ruby-value">:status</span>],
   <span class="ruby-identifier">recording_level</span><span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:l_type</span>] )

    <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span>
      <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>
    <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-get_steps" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_steps</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <ul><li>
<p><strong>Description</strong> :</p>
<ul><li>
<p>It gets Steps from database for the given Station</p>
</li></ul>
</li></ul>
          
          

          
          <div class="method-source-code" id="get_steps-source">
            <pre><span class="ruby-comment"># File app/controllers/overview_controller.rb, line 412</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_steps</span>
  <span class="ruby-ivar">@steps</span> = <span class="ruby-constant">StationStep</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">workflow_station_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:rework_info</span>][<span class="ruby-value">:station_id</span>] )
  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-index" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">index</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <ul><li>
<p><strong>Description</strong> :</p>
<ul><li>
<p>It is executed whenever main index page is requested.</p>
</li><li>
<p>It renders all information regarding Objects, their Attributes and Station
Steps</p>
</li></ul>
</li></ul>
          
          

          
          <div class="method-source-code" id="index-source">
            <pre><span class="ruby-comment"># File app/controllers/overview_controller.rb, line 9</span>
    <span class="ruby-keyword">def</span> <span class="ruby-identifier">index</span>
<span class="ruby-ivar">@label_attributes</span> = <span class="ruby-ivar">@workflow</span>.<span class="ruby-identifier">label_attributes</span>.<span class="ruby-identifier">order</span>(<span class="ruby-value">:sequence</span>) <span class="ruby-comment">#.where(is_visible: true)</span>
<span class="ruby-ivar">@workflow_stations</span> = <span class="ruby-ivar">@workflow</span>.<span class="ruby-identifier">workflow_stations</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">is_visible</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>).<span class="ruby-identifier">order</span>(<span class="ruby-value">:sequence</span>)
<span class="ruby-ivar">@workflows</span> = <span class="ruby-constant">WorkFlow</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">is_active</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>, <span class="ruby-identifier">is_in_use</span><span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>)
<span class="ruby-ivar">@include_canceled</span> = <span class="ruby-identifier">session</span>[<span class="ruby-value">:include_canceled</span>]
<span class="ruby-ivar">@include_completed</span> = <span class="ruby-identifier">session</span>[<span class="ruby-value">:include_completed</span>]
<span class="ruby-ivar">@oops_mode</span> = <span class="ruby-identifier">session</span>[<span class="ruby-value">:oops_mode</span>]
<span class="ruby-identifier">session</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:oops_mode</span>)

<span class="ruby-keyword">if</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">post?</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:object_id</span>].<span class="ruby-identifier">present?</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:object_type</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;L1&#39;</span>
    <span class="ruby-ivar">@l1s</span> = <span class="ruby-ivar">@workflow</span>.<span class="ruby-identifier">l1s</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">id</span><span class="ruby-operator">:</span> [<span class="ruby-identifier">params</span>[<span class="ruby-value">:object_id</span>]])

  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:object_type</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;L2&#39;</span>
    <span class="ruby-ivar">@show_search_result_l2</span> = <span class="ruby-string">&#39;filter_type_l2&#39;</span>
    <span class="ruby-ivar">@l2_records</span> = <span class="ruby-constant">L2</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:object_id</span>])
    <span class="ruby-ivar">@l1s</span> = <span class="ruby-ivar">@workflow</span>.<span class="ruby-identifier">l1s</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">id</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@l2_records</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">l1_id</span>)

  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:object_type</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;L3&#39;</span>
    <span class="ruby-ivar">@show_search_result_l2</span> = <span class="ruby-string">&#39;filter_type_l2&#39;</span>
    <span class="ruby-ivar">@show_search_result_l3</span> = <span class="ruby-string">&#39;filter_type_l3&#39;</span>
    <span class="ruby-identifier">l3</span> = <span class="ruby-constant">L3</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:object_id</span>])
    <span class="ruby-identifier">ll2</span> = <span class="ruby-identifier">l3</span>.<span class="ruby-identifier">l2</span>
    <span class="ruby-ivar">@l3_records</span> = <span class="ruby-constant">L3</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">l3</span>.<span class="ruby-identifier">id</span>)
    <span class="ruby-ivar">@l2_records</span> = <span class="ruby-constant">L2</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">id</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@l3_records</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">l2_id</span>)
    <span class="ruby-ivar">@l1s</span> = <span class="ruby-ivar">@workflow</span>.<span class="ruby-identifier">l1s</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">id</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@l2_records</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">l1_id</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">elsif</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:filter_object_type</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;L1&#39;</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@include_canceled</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;include_canceled&#39;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@include_completed</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;include_completed&#39;</span>
    <span class="ruby-ivar">@l1s</span> = <span class="ruby-ivar">@workflow</span>.<span class="ruby-identifier">l1s</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">id</span><span class="ruby-operator">:</span> [<span class="ruby-identifier">session</span>[<span class="ruby-value">:filter_object_id</span>]])
  <span class="ruby-keyword">elsif</span> <span class="ruby-ivar">@include_canceled</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;include_canceled&#39;</span>
    <span class="ruby-ivar">@l1s</span> = <span class="ruby-ivar">@workflow</span>.<span class="ruby-identifier">l1s</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">id</span><span class="ruby-operator">:</span> [<span class="ruby-identifier">session</span>[<span class="ruby-value">:filter_object_id</span>]], <span class="ruby-identifier">completed_actual</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>)
  <span class="ruby-keyword">elsif</span> <span class="ruby-ivar">@include_completed</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;include_completed&#39;</span>
    <span class="ruby-ivar">@l1s</span> = <span class="ruby-ivar">@workflow</span>.<span class="ruby-identifier">l1s</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">id</span><span class="ruby-operator">:</span> [<span class="ruby-identifier">session</span>[<span class="ruby-value">:filter_object_id</span>]]).<span class="ruby-identifier">where</span>.<span class="ruby-identifier">not</span>(<span class="ruby-identifier">status</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;cancel&#39;</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@l1s</span> = <span class="ruby-ivar">@workflow</span>.<span class="ruby-identifier">l1s</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">id</span><span class="ruby-operator">:</span> [<span class="ruby-identifier">session</span>[<span class="ruby-value">:filter_object_id</span>]], <span class="ruby-identifier">completed_actual</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>).<span class="ruby-identifier">where</span>.<span class="ruby-identifier">not</span>(<span class="ruby-identifier">status</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;cancel&#39;</span>)
  <span class="ruby-keyword">end</span>
  
<span class="ruby-keyword">elsif</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:filter_object_type</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;L2&#39;</span>
  <span class="ruby-ivar">@show_search_result_l2</span> = <span class="ruby-string">&#39;filter_type_l2&#39;</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@include_canceled</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;include_canceled&#39;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@include_completed</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;include_completed&#39;</span>
    <span class="ruby-ivar">@l2_records</span> = <span class="ruby-constant">L2</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:filter_object_id</span>])
    <span class="ruby-ivar">@l1s</span> = <span class="ruby-ivar">@workflow</span>.<span class="ruby-identifier">l1s</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">id</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@l2_records</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">l1_id</span>)
  <span class="ruby-keyword">elsif</span> <span class="ruby-ivar">@include_canceled</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;include_canceled&#39;</span>
    <span class="ruby-ivar">@l2_records</span> = <span class="ruby-constant">L2</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:filter_object_id</span>], <span class="ruby-identifier">completed_actual</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>)
    <span class="ruby-ivar">@l1s</span> = <span class="ruby-ivar">@workflow</span>.<span class="ruby-identifier">l1s</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">id</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@l2_records</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">l1_id</span>, <span class="ruby-identifier">completed_actual</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>)
  <span class="ruby-keyword">elsif</span> <span class="ruby-ivar">@include_completed</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;include_completed&#39;</span>
    <span class="ruby-ivar">@l2_records</span> = <span class="ruby-constant">L2</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:filter_object_id</span>]).<span class="ruby-identifier">where</span>.<span class="ruby-identifier">not</span>(<span class="ruby-identifier">status</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;cancel&#39;</span>)
    <span class="ruby-ivar">@l1s</span> = <span class="ruby-ivar">@workflow</span>.<span class="ruby-identifier">l1s</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">id</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@l2_records</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">l1_id</span>).<span class="ruby-identifier">where</span>.<span class="ruby-identifier">not</span>(<span class="ruby-identifier">status</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;cancel&#39;</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@l2_records</span> = <span class="ruby-constant">L2</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:filter_object_id</span>], <span class="ruby-identifier">completed_actual</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>).<span class="ruby-identifier">where</span>.<span class="ruby-identifier">not</span>(<span class="ruby-identifier">status</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;cancel&#39;</span>)
    <span class="ruby-ivar">@l1s</span> = <span class="ruby-ivar">@workflow</span>.<span class="ruby-identifier">l1s</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">id</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@l2_records</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">l1_id</span>, <span class="ruby-identifier">completed_actual</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>).<span class="ruby-identifier">where</span>.<span class="ruby-identifier">not</span>(<span class="ruby-identifier">status</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;cancel&#39;</span>)
  <span class="ruby-keyword">end</span>
   
<span class="ruby-keyword">elsif</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:filter_object_type</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;L3&#39;</span>
  <span class="ruby-ivar">@show_search_result_l2</span> = <span class="ruby-string">&#39;filter_type_l2&#39;</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">session</span>[<span class="ruby-value">:new_object_added</span>].<span class="ruby-identifier">present?</span> 
    <span class="ruby-ivar">@show_search_result_l3</span> = <span class="ruby-string">&#39;filter_type_l3&#39;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">l3</span> = <span class="ruby-constant">L3</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">session</span>[<span class="ruby-value">:filter_object_id</span>])
  <span class="ruby-identifier">ll2</span> = <span class="ruby-identifier">l3</span>.<span class="ruby-identifier">l2</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@include_canceled</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;include_canceled&#39;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@include_completed</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;include_completed&#39;</span>
    <span class="ruby-ivar">@l3_records</span> = <span class="ruby-constant">L3</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">l3</span>.<span class="ruby-identifier">id</span>)
    <span class="ruby-ivar">@l2_records</span> = <span class="ruby-constant">L2</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">id</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@l3_records</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">l2_id</span>)
    <span class="ruby-ivar">@l1s</span> = <span class="ruby-ivar">@workflow</span>.<span class="ruby-identifier">l1s</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">id</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@l2_records</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">l1_id</span>)
  <span class="ruby-keyword">elsif</span> <span class="ruby-ivar">@include_canceled</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;include_canceled&#39;</span>
    <span class="ruby-ivar">@l3_records</span> = <span class="ruby-constant">L3</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">l3</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">completed_actual</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>)
    <span class="ruby-ivar">@l2_records</span> = <span class="ruby-constant">L2</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">id</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@l3_records</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">l2_id</span>, <span class="ruby-identifier">completed_actual</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>)
    <span class="ruby-ivar">@l1s</span> = <span class="ruby-ivar">@workflow</span>.<span class="ruby-identifier">l1s</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">id</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@l2_records</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">l1_id</span>, <span class="ruby-identifier">completed_actual</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>)
  <span class="ruby-keyword">elsif</span> <span class="ruby-ivar">@include_completed</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;include_completed&#39;</span>
    <span class="ruby-ivar">@l3_records</span> = <span class="ruby-constant">L3</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">l3</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">where</span>.<span class="ruby-identifier">not</span>(<span class="ruby-identifier">status</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;cancel&#39;</span>)
    <span class="ruby-ivar">@l2_records</span> = <span class="ruby-constant">L2</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">id</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@l3_records</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">l2_id</span>).<span class="ruby-identifier">where</span>.<span class="ruby-identifier">not</span>(<span class="ruby-identifier">status</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;cancel&#39;</span>)
    <span class="ruby-ivar">@l1s</span> = <span class="ruby-ivar">@workflow</span>.<span class="ruby-identifier">l1s</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">id</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@l2_records</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">l1_id</span>).<span class="ruby-identifier">where</span>.<span class="ruby-identifier">not</span>(<span class="ruby-identifier">status</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;cancel&#39;</span>)     
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@l3_records</span> = <span class="ruby-constant">L3</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">l3</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">where</span>.<span class="ruby-identifier">not</span>(<span class="ruby-identifier">status</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;cancel&#39;</span>)
    <span class="ruby-ivar">@l2_records</span> = <span class="ruby-constant">L2</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">id</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@l3_records</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">l2_id</span>).<span class="ruby-identifier">where</span>.<span class="ruby-identifier">not</span>(<span class="ruby-identifier">status</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;cancel&#39;</span>)
    <span class="ruby-ivar">@l1s</span> = <span class="ruby-ivar">@workflow</span>.<span class="ruby-identifier">l1s</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">id</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@l2_records</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">l1_id</span>).<span class="ruby-identifier">where</span>.<span class="ruby-identifier">not</span>(<span class="ruby-identifier">status</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;cancel&#39;</span>)        
  <span class="ruby-keyword">end</span>  
<span class="ruby-keyword">else</span>
  <span class="ruby-ivar">@l1s</span> = [] <span class="ruby-comment">#@workflow.l1s.where(completed_actual: nil).where.not(status: &#39;cancel&#39;).order(:id)</span>
<span class="ruby-keyword">end</span>

<span class="ruby-keyword">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:wildcard</span>].<span class="ruby-identifier">present?</span>
  <span class="ruby-ivar">@wildcard</span> = <span class="ruby-identifier">session</span>[<span class="ruby-value">:wildcard</span>]
<span class="ruby-keyword">end</span>
<span class="ruby-keyword">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:exact</span>].<span class="ruby-identifier">present?</span>
  <span class="ruby-ivar">@exact</span> = <span class="ruby-identifier">session</span>[<span class="ruby-value">:exact</span>]
<span class="ruby-keyword">end</span>
<span class="ruby-keyword">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:q_string</span>].<span class="ruby-identifier">present?</span>
  <span class="ruby-identifier">q_string</span> = <span class="ruby-identifier">session</span>[<span class="ruby-value">:q_string</span>]
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@include_canceled</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;include_canceled&#39;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@include_completed</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;include_completed&#39;</span>
    <span class="ruby-ivar">@serach_result</span> = <span class="ruby-constant">WorkFlow</span>.<span class="ruby-identifier">search</span>(<span class="ruby-identifier">q_string</span>)
  <span class="ruby-keyword">elsif</span> <span class="ruby-ivar">@include_canceled</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;include_canceled&#39;</span>
    <span class="ruby-ivar">@serach_result</span> = <span class="ruby-constant">WorkFlow</span>.<span class="ruby-identifier">search_exclude_complete</span>(<span class="ruby-identifier">q_string</span>)
  <span class="ruby-keyword">elsif</span> <span class="ruby-ivar">@include_completed</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;include_completed&#39;</span>
    <span class="ruby-ivar">@serach_result</span> = <span class="ruby-constant">WorkFlow</span>.<span class="ruby-identifier">search_exclude_cancel</span>(<span class="ruby-identifier">q_string</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@serach_result</span> = <span class="ruby-constant">WorkFlow</span>.<span class="ruby-identifier">search_exclude_cancel_and_complete</span>(<span class="ruby-identifier">q_string</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-merge_partial_with_parent" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">merge_partial_with_parent</span><span
            class="method-args">(partial_to_merge_id, rework_object_type, merge_back_time)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <ul><li>
<p><strong>Description</strong> :</p>
<ul><li>
<p>It merges Rework with its immediate active parent iff exists and creates
Additional Information</p>
</li></ul>
</li></ul>
          
          

          
          <div class="method-source-code" id="merge_partial_with_parent-source">
            <pre><span class="ruby-comment"># File app/controllers/overview_controller.rb, line 763</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">merge_partial_with_parent</span>(<span class="ruby-identifier">partial_to_merge_id</span>, <span class="ruby-identifier">rework_object_type</span>, <span class="ruby-identifier">merge_back_time</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">rework_object_type</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;L3&#39;</span>
    <span class="ruby-ivar">@partial_ready_to_merge</span> = <span class="ruby-constant">L3</span>.<span class="ruby-identifier">find_by_id</span>(<span class="ruby-identifier">partial_to_merge_id</span>)
    <span class="ruby-identifier">merge_back_with_id</span> = <span class="ruby-ivar">@partial_ready_to_merge</span>.<span class="ruby-identifier">merge_back_with_id</span>
    <span class="ruby-ivar">@merge_back_with</span> = <span class="ruby-constant">L3</span>.<span class="ruby-identifier">find_by_id</span>(<span class="ruby-identifier">merge_back_with_id</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># reset the num of comp in parent</span>
  <span class="ruby-identifier">num_component_merge_back</span> = <span class="ruby-ivar">@partial_ready_to_merge</span>.<span class="ruby-identifier">num_component</span>
  <span class="ruby-identifier">num_comp_in_parent</span> = <span class="ruby-ivar">@merge_back_with</span>.<span class="ruby-identifier">num_component</span>
  <span class="ruby-identifier">num_component_in_rework</span> = <span class="ruby-ivar">@merge_back_with</span>.<span class="ruby-identifier">num_component_in_rework</span>
  <span class="ruby-comment">#@merge_back_with.num_component = num_comp_in_parent.to_i + num_component_merge_back.to_i</span>
  <span class="ruby-ivar">@merge_back_with</span>.<span class="ruby-identifier">num_component_in_rework</span> = <span class="ruby-identifier">num_component_in_rework</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">num_component_merge_back</span>.<span class="ruby-identifier">to_i</span>
  <span class="ruby-ivar">@merge_back_with</span>.<span class="ruby-identifier">save!</span>

  <span class="ruby-comment"># close the partial</span>
  <span class="ruby-ivar">@partial_ready_to_merge</span>.<span class="ruby-identifier">is_main_record</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-ivar">@partial_ready_to_merge</span>.<span class="ruby-identifier">is_closed</span> = <span class="ruby-keyword">true</span>
  <span class="ruby-ivar">@partial_ready_to_merge</span>.<span class="ruby-identifier">num_component_in_rework</span> = <span class="ruby-value">0</span>
  <span class="ruby-ivar">@partial_ready_to_merge</span>.<span class="ruby-identifier">status</span> = <span class="ruby-string">&#39;Closed&#39;</span>
  <span class="ruby-ivar">@partial_ready_to_merge</span>.<span class="ruby-identifier">merge_back_with_id</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@partial_ready_to_merge</span>.<span class="ruby-identifier">save</span>

    <span class="ruby-comment"># save log of rework done</span>
    <span class="ruby-identifier">reason</span> = <span class="ruby-constant">ReasonCode</span>.<span class="ruby-identifier">find_by_recording_level</span>(<span class="ruby-string">&#39;ReworkMergedBack&#39;</span>)
    <span class="ruby-identifier">reason_id</span> = <span class="ruby-identifier">reason</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">reason</span>.<span class="ruby-identifier">id</span> <span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">formated_merge_back_time</span> = <span class="ruby-constant">L1</span>.<span class="ruby-identifier">set_db_datetime_format</span>(<span class="ruby-identifier">merge_back_time</span>)
    <span class="ruby-constant">AdditionalInfo</span>.<span class="ruby-identifier">create</span>(<span class="ruby-identifier">info_timestamp</span><span class="ruby-operator">:</span> <span class="ruby-identifier">formated_merge_back_time</span> ,<span class="ruby-identifier">object_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">partial_to_merge_id</span>, <span class="ruby-identifier">object_type</span><span class="ruby-operator">:</span> <span class="ruby-identifier">rework_object_type</span>, 
      <span class="ruby-identifier">status</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;Closed&#39;</span>, <span class="ruby-identifier">reason_code_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">reason_id</span>, <span class="ruby-identifier">work_flow_id</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@workflow</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">user_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">id</span>)

    <span class="ruby-comment"># recalculates the ETAS</span>
    <span class="ruby-identifier">work_flowLive_steps</span> = <span class="ruby-ivar">@merge_back_with</span>.<span class="ruby-identifier">workflow_live_steps</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">work_flowLive_steps</span>.<span class="ruby-identifier">present?</span>
      <span class="ruby-identifier">workflowLiveStep</span> = <span class="ruby-identifier">work_flowLive_steps</span>.<span class="ruby-identifier">first</span>
      <span class="ruby-ivar">@partial_ready_to_merge</span>.<span class="ruby-identifier">workflow_live_steps</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">actual_confirmation</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>).<span class="ruby-identifier">update_all</span>(<span class="ruby-identifier">is_active</span><span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>)
      <span class="ruby-constant">WorkflowLiveStep</span>.<span class="ruby-identifier">get_steps_calculate_eta</span>(<span class="ruby-identifier">workflowLiveStep</span>, <span class="ruby-ivar">@workflow</span>, <span class="ruby-identifier">current_user</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">root_path</span>, <span class="ruby-identifier">notice</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;Partial Merged Back successfully.&#39;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-oops_mode" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">oops_mode</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <ul><li>
<p><strong>Description</strong> :</p>
<ul><li>
<p>It turns on Oops mode to update confirmation date.</p>
</li></ul>
</li></ul>
          
          

          
          <div class="method-source-code" id="oops_mode-source">
            <pre><span class="ruby-comment"># File app/controllers/overview_controller.rb, line 1116</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">oops_mode</span>
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:oops_mode</span>] = <span class="ruby-string">&#39;oops_mode&#39;</span>
  <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">root_path</span>, <span class="ruby-identifier">notice</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;Oops mode is turned on.&#39;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-open_confirm_modal" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">open_confirm_modal</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <ul><li>
<p><strong>Description</strong> :</p>
<ul><li>
<p>It finds information for Task Confirmation of a Station Step and renders a
pop-up it via open_confirm_modal.js.erb</p>
</li></ul>
</li></ul>
          
          

          
          <div class="method-source-code" id="open_confirm_modal-source">
            <pre><span class="ruby-comment"># File app/controllers/overview_controller.rb, line 810</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">open_confirm_modal</span>
  <span class="ruby-identifier">session</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:open_confirm_modal</span>)
  <span class="ruby-ivar">@wf_step_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:wf_step_id</span>]
  <span class="ruby-identifier">workflow_live_tep</span> = <span class="ruby-constant">WorkflowLiveStep</span>.<span class="ruby-identifier">find</span>(<span class="ruby-ivar">@wf_step_id</span>)
 
  <span class="ruby-ivar">@st_step</span> = <span class="ruby-identifier">workflow_live_tep</span>.<span class="ruby-identifier">station_step</span>.<span class="ruby-identifier">step_name</span>
  <span class="ruby-ivar">@st_name</span> = <span class="ruby-identifier">workflow_live_tep</span>.<span class="ruby-identifier">station_step</span>.<span class="ruby-identifier">workflow_station</span>.<span class="ruby-identifier">station_name</span>


  <span class="ruby-keyword">if</span> <span class="ruby-identifier">workflow_live_tep</span>.<span class="ruby-identifier">object_type</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;L1&#39;</span>
    <span class="ruby-ivar">@l1</span> = <span class="ruby-constant">L1</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">workflow_live_tep</span>.<span class="ruby-identifier">object_id</span>)
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">workflow_live_tep</span>.<span class="ruby-identifier">object_type</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;L2&#39;</span>
    <span class="ruby-ivar">@l2</span> = <span class="ruby-constant">L2</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">workflow_live_tep</span>.<span class="ruby-identifier">object_id</span>)
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">workflow_live_tep</span>.<span class="ruby-identifier">object_type</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;L3&#39;</span>
    <span class="ruby-ivar">@l3</span> = <span class="ruby-constant">L3</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">workflow_live_tep</span>.<span class="ruby-identifier">object_id</span>)
  <span class="ruby-keyword">end</span>  
  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> { <span class="ruby-identifier">render</span> <span class="ruby-value">:partial</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;confirm_modal&quot;</span> }
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-open_info_modal_l1" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">open_info_modal_l1</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <ul><li>
<p><strong>Description</strong> :</p>
<ul><li>
<p>It finds information for l1s Addditional Information and renders pop-up via
open_info_modal_l1.js.erb</p>
</li></ul>
</li></ul>
          
          

          
          <div class="method-source-code" id="open_info_modal_l1-source">
            <pre><span class="ruby-comment"># File app/controllers/overview_controller.rb, line 114</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">open_info_modal_l1</span>
  <span class="ruby-identifier">session</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:oops_mode</span>)
  <span class="ruby-ivar">@report_info</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:report_info</span>]
  <span class="ruby-ivar">@type</span> = <span class="ruby-string">&#39;L1&#39;</span> 
  <span class="ruby-ivar">@l1</span> = <span class="ruby-constant">L1</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:l1_id</span>])
  <span class="ruby-ivar">@status_</span> = <span class="ruby-ivar">@l1</span>.<span class="ruby-identifier">status</span>

  <span class="ruby-ivar">@reasons</span> = <span class="ruby-constant">ReasonCode</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">status</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@status_</span>,
   <span class="ruby-identifier">recording_level</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@type</span> ).<span class="ruby-identifier">order</span>(<span class="ruby-value">:sequence</span>)


  <span class="ruby-ivar">@additional_info</span> = <span class="ruby-constant">AdditionalInfo</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-ivar">@workflow_stations</span> = <span class="ruby-ivar">@workflow</span>.<span class="ruby-identifier">workflow_stations</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">is_visible</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>).<span class="ruby-identifier">order</span>(<span class="ruby-value">:sequence</span>)
  <span class="ruby-ivar">@info_status</span> = <span class="ruby-ivar">@workflow</span>.<span class="ruby-identifier">statuses</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">recording_level</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;L1&#39;</span>)
  <span class="ruby-ivar">@additional_info_data</span> = <span class="ruby-ivar">@workflow</span>.<span class="ruby-identifier">additional_infos</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">object_id</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@l1</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">object_type</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;L1&#39;</span>).<span class="ruby-identifier">order</span>(<span class="ruby-identifier">id</span><span class="ruby-operator">:</span> <span class="ruby-value">:desc</span>)
  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>
  <span class="ruby-keyword">end</span>
 <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-open_info_modal_l2" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">open_info_modal_l2</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <ul><li>
<p><strong>Description</strong> :</p>
<ul><li>
<p>It finds information for l12s Addditional Information and renders pop-up
via open_info_modal_l2.js.erb</p>
</li></ul>
</li></ul>
          
          

          
          <div class="method-source-code" id="open_info_modal_l2-source">
            <pre><span class="ruby-comment"># File app/controllers/overview_controller.rb, line 187</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">open_info_modal_l2</span>
 <span class="ruby-identifier">session</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:oops_mode</span>)
 <span class="ruby-ivar">@report_info</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:report_info</span>]
 <span class="ruby-ivar">@type</span> = <span class="ruby-string">&#39;L2&#39;</span>
 <span class="ruby-ivar">@l2</span> = <span class="ruby-constant">L2</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:l2_id</span>])
 <span class="ruby-ivar">@status_</span> = <span class="ruby-ivar">@l2</span>.<span class="ruby-identifier">status</span>

 <span class="ruby-ivar">@reasons</span> = <span class="ruby-constant">ReasonCode</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">status</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@status_</span>,
  <span class="ruby-identifier">recording_level</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@type</span> ).<span class="ruby-identifier">order</span>(<span class="ruby-value">:sequence</span>)

 <span class="ruby-ivar">@additional_info</span> = <span class="ruby-constant">AdditionalInfo</span>.<span class="ruby-identifier">new</span>
 <span class="ruby-ivar">@workflow_stations</span> = <span class="ruby-ivar">@workflow</span>.<span class="ruby-identifier">workflow_stations</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">is_visible</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>).<span class="ruby-identifier">order</span>(<span class="ruby-value">:sequence</span>)
 <span class="ruby-ivar">@info_status</span> = <span class="ruby-ivar">@workflow</span>.<span class="ruby-identifier">statuses</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">recording_level</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;L2&#39;</span>)
 <span class="ruby-ivar">@additional_info_data</span> = <span class="ruby-ivar">@workflow</span>.<span class="ruby-identifier">additional_infos</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">object_id</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@l2</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">object_type</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;L2&#39;</span>).<span class="ruby-identifier">order</span>(<span class="ruby-identifier">id</span><span class="ruby-operator">:</span> <span class="ruby-value">:desc</span>)
 <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
   <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span>
   <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>
 <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-open_info_modal_l3" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">open_info_modal_l3</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <ul><li>
<p><strong>Description</strong> :</p>
<ul><li>
<p>It finds information for l3s Addditional Information and renders pop-up via
open_info_modal_l3.js.erb</p>
</li></ul>
</li></ul>
          
          

          
          <div class="method-source-code" id="open_info_modal_l3-source">
            <pre><span class="ruby-comment"># File app/controllers/overview_controller.rb, line 210</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">open_info_modal_l3</span>
 <span class="ruby-identifier">session</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:oops_mode</span>)
 <span class="ruby-ivar">@report_info</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:report_info</span>]
 <span class="ruby-ivar">@type</span> = <span class="ruby-string">&#39;L3&#39;</span>
 <span class="ruby-ivar">@l3</span> = <span class="ruby-constant">L3</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:l3_id</span>])
 <span class="ruby-ivar">@status_</span> = <span class="ruby-ivar">@l3</span>.<span class="ruby-identifier">status</span>

 <span class="ruby-ivar">@reasons</span> = <span class="ruby-constant">ReasonCode</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">status</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@status_</span>,
  <span class="ruby-identifier">recording_level</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@type</span> ).<span class="ruby-identifier">order</span>(<span class="ruby-value">:sequence</span>)

 <span class="ruby-ivar">@additional_info</span> = <span class="ruby-constant">AdditionalInfo</span>.<span class="ruby-identifier">new</span>
 <span class="ruby-ivar">@workflow_stations</span> = <span class="ruby-ivar">@workflow</span>.<span class="ruby-identifier">workflow_stations</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">is_visible</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>).<span class="ruby-identifier">order</span>(<span class="ruby-value">:sequence</span>)
 <span class="ruby-ivar">@info_status</span> = <span class="ruby-ivar">@workflow</span>.<span class="ruby-identifier">statuses</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">recording_level</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;L3&#39;</span>)
 <span class="ruby-ivar">@additional_info_data</span> = <span class="ruby-ivar">@workflow</span>.<span class="ruby-identifier">additional_infos</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">object_id</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@l3</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">object_type</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;L3&#39;</span>).<span class="ruby-identifier">order</span>(<span class="ruby-identifier">id</span><span class="ruby-operator">:</span> <span class="ruby-value">:desc</span>)
 <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
   <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span>
   <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>
 <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-open_rework_modal" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">open_rework_modal</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <ul><li>
<p><strong>Description</strong> :</p>
<ul><li>
<p>It finds information for l3s rework pop-up and render it via
open_rework_modal.js.erb</p>
</li></ul>
</li></ul>
          
          

          
          <div class="method-source-code" id="open_rework_modal-source">
            <pre><span class="ruby-comment"># File app/controllers/overview_controller.rb, line 424</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">open_rework_modal</span>
  <span class="ruby-ivar">@wf_step_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:wf_step_id</span>]
  <span class="ruby-identifier">workflow_live_step</span> = <span class="ruby-constant">WorkflowLiveStep</span>.<span class="ruby-identifier">find</span>(<span class="ruby-ivar">@wf_step_id</span>)
  <span class="ruby-ivar">@rework</span> = <span class="ruby-constant">ReworkInfo</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-ivar">@object</span> = <span class="ruby-identifier">workflow_live_step</span>.<span class="ruby-identifier">object</span>
  <span class="ruby-ivar">@can_merge_back</span> = <span class="ruby-identifier">can_merge_back_with_parent</span>(<span class="ruby-ivar">@object</span>)

  <span class="ruby-identifier">rework_components</span> = <span class="ruby-value">0</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@object</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;L3&#39;</span>
      <span class="ruby-identifier">reworks</span> = <span class="ruby-constant">L3</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">rework_parent_id</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@object</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">is_closed</span><span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>)
      <span class="ruby-identifier">reworks</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">rework</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">rework_components</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">rework</span>.<span class="ruby-identifier">num_component</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">closed_reworks</span> = <span class="ruby-constant">L3</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">rework_parent_id</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@object</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">is_closed</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>)
      <span class="ruby-identifier">closed_reworks</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">clos_rework</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">closed_reworks_partial</span> = <span class="ruby-constant">L3</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">rework_parent_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">clos_rework</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">is_closed</span><span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>)
        <span class="ruby-identifier">closed_reworks_partial</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">closedreworkspartial</span><span class="ruby-operator">|</span>
          <span class="ruby-identifier">rework_components</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">closedreworkspartial</span>.<span class="ruby-identifier">num_component</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@rework_components</span> = <span class="ruby-identifier">rework_components</span>
  <span class="ruby-ivar">@object_num_component</span> = <span class="ruby-ivar">@object</span>.<span class="ruby-identifier">num_component</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">?</span> <span class="ruby-ivar">@object</span>.<span class="ruby-identifier">num_component</span> <span class="ruby-operator">:</span> <span class="ruby-value">1</span>
  <span class="ruby-ivar">@object_num_component</span> = <span class="ruby-ivar">@object_num_component</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">rework_components</span>.<span class="ruby-identifier">to_i</span>

  <span class="ruby-ivar">@object_live_steps</span> = <span class="ruby-ivar">@object</span>.<span class="ruby-identifier">workflow_live_steps</span>
  <span class="ruby-ivar">@object_type</span> = <span class="ruby-identifier">workflow_live_step</span>.<span class="ruby-identifier">object_type</span>
  <span class="ruby-ivar">@user_id</span> = <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">id</span>
  <span class="ruby-ivar">@current_step</span> = <span class="ruby-identifier">workflow_live_step</span>.<span class="ruby-identifier">station_step</span>
  <span class="ruby-ivar">@current_station</span> = <span class="ruby-identifier">workflow_live_step</span>.<span class="ruby-identifier">station_step</span>.<span class="ruby-identifier">workflow_station</span>
  <span class="ruby-ivar">@reason_codes</span> = <span class="ruby-ivar">@workflow</span>.<span class="ruby-identifier">reason_codes</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">status</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;Rework&#39;</span>, <span class="ruby-identifier">recording_level</span><span class="ruby-operator">:</span> <span class="ruby-identifier">workflow_live_step</span>.<span class="ruby-identifier">object_type</span>)
  <span class="ruby-ivar">@level_workflow_stations</span> = <span class="ruby-ivar">@workflow</span>.<span class="ruby-identifier">workflow_stations</span>.<span class="ruby-identifier">joins</span>(<span class="ruby-value">:station_steps</span>).<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;station_steps.recording_level=&#39;#{workflow_live_step.object_type}&#39; and workflow_stations.sequence &lt;= #{@current_station.sequence} and workflow_stations.is_visible=true&quot;</span>).<span class="ruby-identifier">order</span>(<span class="ruby-value">:sequence</span>).<span class="ruby-identifier">uniq</span>

  <span class="ruby-ivar">@level_steps</span> = []
  <span class="ruby-ivar">@level_workflow_stations</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">level_station</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">level_station</span>.<span class="ruby-identifier">id</span> <span class="ruby-operator">==</span> <span class="ruby-ivar">@current_station</span>.<span class="ruby-identifier">id</span>
      <span class="ruby-identifier">level_station</span>.<span class="ruby-identifier">station_steps</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;is_visible=#{true} and recording_level=&#39;#{workflow_live_step.object_type}&#39; and sequence &lt;= #{@current_step.sequence}&quot;</span>).<span class="ruby-identifier">order</span>(<span class="ruby-value">:sequence</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">stp</span><span class="ruby-operator">|</span>
       <span class="ruby-identifier">liveStepObject</span> = <span class="ruby-ivar">@object_live_steps</span>.<span class="ruby-identifier">find</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">live_step</span><span class="ruby-operator">|</span> <span class="ruby-identifier">live_step</span>.<span class="ruby-identifier">station_step_id</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">stp</span>.<span class="ruby-identifier">id</span> }
        
          <span class="ruby-ivar">@level_steps</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">stp</span>
       
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">level_station</span>.<span class="ruby-identifier">station_steps</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;is_visible=#{true} and recording_level=&#39;#{workflow_live_step.object_type}&#39;&quot;</span>).<span class="ruby-identifier">order</span>(<span class="ruby-value">:sequence</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">stp</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">liveStepObject</span> = <span class="ruby-ivar">@object_live_steps</span>.<span class="ruby-identifier">find</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">live_step</span><span class="ruby-operator">|</span> <span class="ruby-identifier">live_step</span>.<span class="ruby-identifier">station_step_id</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">stp</span>.<span class="ruby-identifier">id</span> }
       
          <span class="ruby-ivar">@level_steps</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">stp</span>
       
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>  
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">workflow_live_step</span>.<span class="ruby-identifier">object_type</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;L1&#39;</span>
    <span class="ruby-ivar">@l1</span> = <span class="ruby-constant">L1</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">workflow_live_step</span>.<span class="ruby-identifier">object_id</span>)
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">workflow_live_step</span>.<span class="ruby-identifier">object_type</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;L2&#39;</span>
    <span class="ruby-ivar">@l2</span> = <span class="ruby-constant">L2</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">workflow_live_step</span>.<span class="ruby-identifier">object_id</span>)
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">workflow_live_step</span>.<span class="ruby-identifier">object_type</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;L3&#39;</span>
    <span class="ruby-ivar">@l3</span> = <span class="ruby-constant">L3</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">workflow_live_step</span>.<span class="ruby-identifier">object_id</span>)
  <span class="ruby-keyword">end</span>  

  <span class="ruby-ivar">@show_merge_button_disable</span> = <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@l3</span>.<span class="ruby-identifier">is_main_record</span>.<span class="ruby-identifier">present?</span>
    <span class="ruby-ivar">@show_merge_button_disable</span> = <span class="ruby-keyword">false</span> 
  <span class="ruby-keyword">end</span>
    
  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-project_deatils_l1" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">project_deatils_l1</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <ul><li>
<p><strong>Description</strong> :</p>
<ul><li>
<p>It get details of the l1s of given id from search results and then then
renders pop-up via project_deatils_l1.js.erb</p>
</li></ul>
</li></ul>
          
          

          
          <div class="method-source-code" id="project_deatils_l1-source">
            <pre><span class="ruby-comment"># File app/controllers/overview_controller.rb, line 977</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">project_deatils_l1</span>
  <span class="ruby-ivar">@label_attributes</span> = <span class="ruby-ivar">@workflow</span>.<span class="ruby-identifier">label_attributes</span>.<span class="ruby-identifier">order</span>(<span class="ruby-value">:sequence</span>) <span class="ruby-comment">#.where(is_visible: true)</span>
  <span class="ruby-ivar">@workflow_stations</span> = <span class="ruby-ivar">@workflow</span>.<span class="ruby-identifier">workflow_stations</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">is_visible</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>).<span class="ruby-identifier">order</span>(<span class="ruby-value">:sequence</span>)
  <span class="ruby-ivar">@workflows</span> = <span class="ruby-constant">WorkFlow</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">is_active</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>, <span class="ruby-identifier">is_in_use</span><span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>)
  <span class="ruby-comment">#show all search result link on search box </span>
  <span class="ruby-identifier">l1_list</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:l1_id</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&#39;_&#39;</span>)
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:filter_object_id</span>] = <span class="ruby-identifier">l1_list</span>
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:filter_object_type</span>] = <span class="ruby-string">&#39;L1&#39;</span>
  <span class="ruby-ivar">@include_canceled</span> = <span class="ruby-identifier">session</span>[<span class="ruby-value">:include_canceled</span>]
  <span class="ruby-ivar">@include_completed</span> = <span class="ruby-identifier">session</span>[<span class="ruby-value">:include_completed</span>]
  <span class="ruby-identifier">session</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:new_object_added</span>)
  <span class="ruby-ivar">@l1s</span> = <span class="ruby-constant">L1</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">id</span><span class="ruby-operator">:</span> [<span class="ruby-identifier">l1_list</span>])

  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>
  <span class="ruby-keyword">end</span> 
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-project_deatils_l2" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">project_deatils_l2</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <ul><li>
<p><strong>Description</strong> :</p>
<ul><li>
<p>It get details of the l2s of given id from search results and then then
renders pop-up via project_deatils_l2.js.erb</p>
</li></ul>
</li></ul>
          
          

          
          <div class="method-source-code" id="project_deatils_l2-source">
            <pre><span class="ruby-comment"># File app/controllers/overview_controller.rb, line 999</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">project_deatils_l2</span>
  <span class="ruby-ivar">@show_search_result_l2</span> = <span class="ruby-string">&#39;filter_type_l2&#39;</span> 
  <span class="ruby-ivar">@label_attributes</span> = <span class="ruby-ivar">@workflow</span>.<span class="ruby-identifier">label_attributes</span>.<span class="ruby-identifier">order</span>(<span class="ruby-value">:sequence</span>) <span class="ruby-comment">#.where(is_visible: true)</span>
  <span class="ruby-ivar">@workflow_stations</span> = <span class="ruby-ivar">@workflow</span>.<span class="ruby-identifier">workflow_stations</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">is_visible</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>).<span class="ruby-identifier">order</span>(<span class="ruby-value">:sequence</span>)
  <span class="ruby-ivar">@workflows</span> = <span class="ruby-constant">WorkFlow</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">is_active</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>, <span class="ruby-identifier">is_in_use</span><span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>)
  <span class="ruby-identifier">l2_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:l2_id</span>]
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:filter_object_id</span>] = <span class="ruby-identifier">l2_id</span>
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:filter_object_type</span>] = <span class="ruby-string">&#39;L2&#39;</span>
  <span class="ruby-ivar">@include_canceled</span> = <span class="ruby-identifier">session</span>[<span class="ruby-value">:include_canceled</span>]
  <span class="ruby-ivar">@include_completed</span> = <span class="ruby-identifier">session</span>[<span class="ruby-value">:include_completed</span>]
  <span class="ruby-identifier">session</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:new_object_added</span>)

  <span class="ruby-ivar">@l2_records</span> = <span class="ruby-constant">L2</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">l2_id</span>)
  <span class="ruby-ivar">@l1s</span> = <span class="ruby-constant">L1</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">id</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@l2_records</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">l1_id</span>)

  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>
  <span class="ruby-keyword">end</span> 
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-project_deatils_l3" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">project_deatils_l3</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <ul><li>
<p><strong>Description</strong> :</p>
<ul><li>
<p>It get details of the l3s of given id from search results and then then
renders pop-up via project_deatils_l3.js.erb</p>
</li></ul>
</li></ul>
          
          

          
          <div class="method-source-code" id="project_deatils_l3-source">
            <pre><span class="ruby-comment"># File app/controllers/overview_controller.rb, line 1023</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">project_deatils_l3</span>
  <span class="ruby-ivar">@show_search_result_l2</span> = <span class="ruby-string">&#39;filter_type_l2&#39;</span> 
  <span class="ruby-ivar">@show_search_result_l3</span> = <span class="ruby-string">&#39;filter_type_l3&#39;</span> 
  <span class="ruby-ivar">@label_attributes</span> = <span class="ruby-ivar">@workflow</span>.<span class="ruby-identifier">label_attributes</span>.<span class="ruby-identifier">order</span>(<span class="ruby-value">:sequence</span>) <span class="ruby-comment">#.where(is_visible: true)</span>
  <span class="ruby-ivar">@workflow_stations</span> = <span class="ruby-ivar">@workflow</span>.<span class="ruby-identifier">workflow_stations</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">is_visible</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>).<span class="ruby-identifier">order</span>(<span class="ruby-value">:sequence</span>)
  <span class="ruby-ivar">@workflows</span> = <span class="ruby-constant">WorkFlow</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">is_active</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>, <span class="ruby-identifier">is_in_use</span><span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>)
  <span class="ruby-identifier">l3_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:l3_id</span>]
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:filter_object_id</span>] = <span class="ruby-identifier">l3_id</span>
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:filter_object_type</span>] = <span class="ruby-string">&#39;L3&#39;</span>
  <span class="ruby-ivar">@include_canceled</span> = <span class="ruby-identifier">session</span>[<span class="ruby-value">:include_canceled</span>]
  <span class="ruby-ivar">@include_completed</span> = <span class="ruby-identifier">session</span>[<span class="ruby-value">:include_completed</span>]
  <span class="ruby-identifier">session</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:new_object_added</span>)

  <span class="ruby-identifier">l3</span> = <span class="ruby-constant">L3</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">l3_id</span>)
  <span class="ruby-identifier">ll2</span> = <span class="ruby-identifier">l3</span>.<span class="ruby-identifier">l2</span>

  <span class="ruby-ivar">@l3_records</span> = <span class="ruby-constant">L3</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">l3_id</span>)
  <span class="ruby-ivar">@l2_records</span> = <span class="ruby-constant">L2</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">id</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@l3_records</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">l2_id</span>)
  <span class="ruby-ivar">@l1s</span> = <span class="ruby-constant">L1</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">id</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@l2_records</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">l1_id</span>)

  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>
  <span class="ruby-keyword">end</span> 
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-recalculate_all_eta" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">recalculate_all_eta</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <ul><li>
<p><strong>Description</strong> :</p>
<ul><li>
<p>It recalculate all ETAs by calling a function named
“get_steps_calculate_eta” from Workflow Live Steps modal</p>
</li></ul>
</li></ul>
          
          

          
          <div class="method-source-code" id="recalculate_all_eta-source">
            <pre><span class="ruby-comment"># File app/controllers/overview_controller.rb, line 162</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">recalculate_all_eta</span>
 <span class="ruby-keyword">if</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">is_admin</span>
   <span class="ruby-identifier">l1s</span> = <span class="ruby-ivar">@workflow</span>.<span class="ruby-identifier">l1s</span>.<span class="ruby-identifier">where</span>.<span class="ruby-identifier">not</span>(<span class="ruby-identifier">status</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;cancel&#39;</span>)
   <span class="ruby-identifier">l1s</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">l1_id</span><span class="ruby-operator">|</span>
       <span class="ruby-identifier">workflowLiveStep</span> = <span class="ruby-constant">WorkflowLiveStep</span>.<span class="ruby-identifier">find_by_object_id_and_object_type</span>(<span class="ruby-identifier">l1_id</span>,<span class="ruby-string">&#39;L1&#39;</span>)
       <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">workflowLiveStep</span>.<span class="ruby-identifier">present?</span>
           <span class="ruby-identifier">l1</span> = <span class="ruby-constant">L1</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">l1_id</span>)
           <span class="ruby-keyword">if</span> <span class="ruby-identifier">l1</span>.<span class="ruby-identifier">l2s</span>.<span class="ruby-identifier">present?</span>
             <span class="ruby-identifier">l2</span> = <span class="ruby-identifier">l1</span>.<span class="ruby-identifier">l2s</span>.<span class="ruby-identifier">first</span>
             <span class="ruby-identifier">workflowLiveStep</span> = <span class="ruby-constant">WorkflowLiveStep</span>.<span class="ruby-identifier">find_by_object_id_and_object_type</span>(<span class="ruby-identifier">l2</span>.<span class="ruby-identifier">id</span>,<span class="ruby-string">&#39;L2&#39;</span>)
           <span class="ruby-keyword">end</span>
       <span class="ruby-keyword">end</span>
       <span class="ruby-keyword">if</span> <span class="ruby-identifier">workflowLiveStep</span>.<span class="ruby-identifier">present?</span>
         <span class="ruby-constant">WorkflowLiveStep</span>.<span class="ruby-identifier">get_steps_calculate_eta</span>(<span class="ruby-identifier">workflowLiveStep</span>, <span class="ruby-ivar">@workflow</span>,<span class="ruby-identifier">current_user</span>)
       <span class="ruby-keyword">end</span>
   <span class="ruby-keyword">end</span>
   <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">root_path</span>, <span class="ruby-identifier">notice</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;ETA\s re-calculated successfully.&#39;</span>
 <span class="ruby-keyword">else</span>
   <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">root_path</span>, <span class="ruby-identifier">alert</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;You don&#39;t have permission to perform this action!&quot;</span>  
 <span class="ruby-keyword">end</span>  
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-reject_reason_modal" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">reject_reason_modal</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <ul><li>
<p><strong>Description</strong> :</p>
<ul><li>
<p>It finds Information for reject reason and opens pop-up via
reject_reason_modal.js.erb</p>
</li></ul>
</li></ul>
          
          

          
          <div class="method-source-code" id="reject_reason_modal-source">
            <pre><span class="ruby-comment"># File app/controllers/overview_controller.rb, line 937</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">reject_reason_modal</span>
  <span class="ruby-identifier">session</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:open_reason_modal</span>)
  <span class="ruby-identifier">l2_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>]
  <span class="ruby-ivar">@l2</span> = <span class="ruby-constant">L2</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">l2_id</span>)

  <span class="ruby-ivar">@reason_codes</span> = <span class="ruby-ivar">@workflow</span>.<span class="ruby-identifier">reason_codes</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">status</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;Rejected&#39;</span>, <span class="ruby-identifier">recording_level</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;L2&#39;</span>)
  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> { <span class="ruby-identifier">render</span> <span class="ruby-value">:partial</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;reject_reason_modal&quot;</span> }
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-save_reject_reason" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">save_reject_reason</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <ul><li>
<p><strong>Description</strong> :</p>
<ul><li>
<p>It saves Reject Reasons for <a href="L2.html">L2</a></p>
</li></ul>
</li></ul>
          
          

          
          <div class="method-source-code" id="save_reject_reason-source">
            <pre><span class="ruby-comment"># File app/controllers/overview_controller.rb, line 952</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">save_reject_reason</span>
  <span class="ruby-identifier">additional_info_id</span> = <span class="ruby-identifier">session</span>[<span class="ruby-value">:additional_info_id</span>]
  <span class="ruby-identifier">codes</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:additional_info</span>][<span class="ruby-value">:reason_code_id</span>]
  <span class="ruby-comment"># if codes.present?</span>
  <span class="ruby-comment">#   ids = &#39;&#39;</span>
  <span class="ruby-comment">#   codes.each do |t|</span>
  <span class="ruby-comment">#     ids += t + &#39;,&#39;</span>
  <span class="ruby-comment">#   end</span>
  <span class="ruby-comment">#   ids = ids.chop</span>
  <span class="ruby-comment"># end</span>
  <span class="ruby-identifier">ids</span> = <span class="ruby-string">&#39;&#39;</span>
  <span class="ruby-identifier">codes</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">ids</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">t</span> <span class="ruby-operator">+</span> <span class="ruby-string">&#39;,&#39;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">ids</span>.<span class="ruby-identifier">presence</span>
    <span class="ruby-identifier">ids</span>.<span class="ruby-identifier">slice!</span>(<span class="ruby-value">-1</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-constant">AdditionalInfo</span>.<span class="ruby-identifier">update</span>(<span class="ruby-identifier">additional_info_id</span>, <span class="ruby-identifier">reason_code_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">ids</span>, <span class="ruby-identifier">note</span><span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:additional_info</span>][<span class="ruby-value">:note</span>])
  <span class="ruby-identifier">session</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:additional_info_id</span>)
  <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">root_path</span>, <span class="ruby-identifier">notice</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;Reject reason saved&#39;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-search" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">search</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <ul><li>
<p><strong>Description</strong> :</p>
<ul><li>
<p>It query dataBase for search Attributes provided through search Panel.</p>
</li><li>
<p>It calls a function named “search” from Workflow pop-up which execute query
and returns result</p>
</li></ul>
</li></ul>
          
          

          
          <div class="method-source-code" id="search-source">
            <pre><span class="ruby-comment"># File app/controllers/overview_controller.rb, line 856</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">search</span>
  <span class="ruby-identifier">q_string</span> = <span class="ruby-string">&#39;&#39;</span>;
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:wildcard</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-value">:wildcard</span>]
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:exact</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-value">:exact</span>]
  
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:include_canceled</span>].<span class="ruby-identifier">presence</span>
    <span class="ruby-identifier">include_canceled</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:include_canceled</span>]
    <span class="ruby-identifier">session</span>[<span class="ruby-value">:include_canceled</span>] = <span class="ruby-identifier">include_canceled</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">session</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:include_canceled</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:include_completed</span>].<span class="ruby-identifier">presence</span>
    <span class="ruby-identifier">include_completed</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:include_completed</span>]
    <span class="ruby-identifier">session</span>[<span class="ruby-value">:include_completed</span>] = <span class="ruby-identifier">include_completed</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">session</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:include_completed</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">wildcard_bu</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:wildcard</span>][<span class="ruby-value">:business_unit</span>]
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">wildcard_bu</span>.<span class="ruby-identifier">presence</span>
    <span class="ruby-identifier">q_string</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;(l1s.business_unit like &#39;%#{wildcard_bu}%&#39;&quot;</span>
    <span class="ruby-identifier">q_string</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;OR l2s.business_unit like &#39;%#{wildcard_bu}%&#39;&quot;</span>
    <span class="ruby-identifier">q_string</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;OR l3s.business_unit like &#39;%#{wildcard_bu}%&#39;)&quot;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">wildcard_l1</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:wildcard</span>][<span class="ruby-value">:l1</span>]
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">wildcard_l1</span>.<span class="ruby-identifier">presence</span>
    <span class="ruby-identifier">q_string</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">q_string</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&#39;&#39;</span> <span class="ruby-operator">?</span> <span class="ruby-string">&#39; and &#39;</span> <span class="ruby-operator">:</span> <span class="ruby-string">&#39;&#39;</span>
    <span class="ruby-identifier">q_string</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;l1s.name like &#39;%#{wildcard_l1}%&#39;&quot;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">wildcard_l2</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:wildcard</span>][<span class="ruby-value">:l2</span>]
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">wildcard_l2</span>.<span class="ruby-identifier">presence</span>
    <span class="ruby-identifier">q_string</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">q_string</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&#39;&#39;</span> <span class="ruby-operator">?</span> <span class="ruby-string">&#39; and &#39;</span> <span class="ruby-operator">:</span> <span class="ruby-string">&#39;&#39;</span>
    <span class="ruby-identifier">q_string</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;l2s.name like &#39;%#{wildcard_l2}%&#39;&quot;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">wildcard_l3</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:wildcard</span>][<span class="ruby-value">:l3</span>]
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">wildcard_l3</span>.<span class="ruby-identifier">presence</span>
    <span class="ruby-identifier">q_string</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">q_string</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&#39;&#39;</span> <span class="ruby-operator">?</span> <span class="ruby-string">&#39; and &#39;</span> <span class="ruby-operator">:</span> <span class="ruby-string">&#39;&#39;</span>
    <span class="ruby-identifier">q_string</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;l3s.name like &#39;%#{wildcard_l3}%&#39;&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">exact_bu</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:exact</span>][<span class="ruby-value">:business_unit</span>]
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">exact_bu</span>.<span class="ruby-identifier">presence</span>
    <span class="ruby-identifier">q_string</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">q_string</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&#39;&#39;</span> <span class="ruby-operator">?</span> <span class="ruby-string">&#39; and &#39;</span> <span class="ruby-operator">:</span> <span class="ruby-string">&#39;&#39;</span>
    <span class="ruby-identifier">q_string</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;(l1s.business_unit = &#39;#{exact_bu}&#39;&quot;</span>
    <span class="ruby-identifier">q_string</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;OR l2s.business_unit = &#39;#{exact_bu}&#39;&quot;</span>
    <span class="ruby-identifier">q_string</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;OR l3s.business_unit = &#39;#{exact_bu}&#39;)&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">exact_l2</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:exact</span>][<span class="ruby-value">:l2</span>]
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">exact_l2</span>.<span class="ruby-identifier">presence</span>
    <span class="ruby-identifier">q_string</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">q_string</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&#39;&#39;</span> <span class="ruby-operator">?</span> <span class="ruby-string">&#39; and &#39;</span> <span class="ruby-operator">:</span> <span class="ruby-string">&#39;&#39;</span>
    <span class="ruby-identifier">q_string</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;l2s.name = &#39;#{exact_l2}&#39;&quot;</span>
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@workflow</span>.<span class="ruby-identifier">id</span>.<span class="ruby-identifier">presence</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">q_string</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&#39;&#39;</span>
    <span class="ruby-identifier">q_string</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">q_string</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&#39;&#39;</span> <span class="ruby-operator">?</span> <span class="ruby-string">&#39; and &#39;</span> <span class="ruby-operator">:</span> <span class="ruby-string">&#39;&#39;</span>
    <span class="ruby-identifier">q_string</span> <span class="ruby-operator">+=</span> <span class="ruby-string">&quot;l1s.work_flow_id = &quot;</span><span class="ruby-operator">+</span> <span class="ruby-ivar">@workflow</span>.<span class="ruby-identifier">id</span>.<span class="ruby-identifier">to_s</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:q_string</span>] = <span class="ruby-identifier">q_string</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">q_string</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&#39;&#39;</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">include_canceled</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;include_canceled&#39;</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">include_completed</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;include_completed&#39;</span>
      <span class="ruby-ivar">@serach_result</span> = <span class="ruby-constant">WorkFlow</span>.<span class="ruby-identifier">search</span>(<span class="ruby-identifier">q_string</span>)
    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">include_canceled</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;include_canceled&#39;</span>
      <span class="ruby-ivar">@serach_result</span> = <span class="ruby-constant">WorkFlow</span>.<span class="ruby-identifier">search_exclude_complete</span>(<span class="ruby-identifier">q_string</span>)
    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">include_completed</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;include_completed&#39;</span>
      <span class="ruby-ivar">@serach_result</span> = <span class="ruby-constant">WorkFlow</span>.<span class="ruby-identifier">search_exclude_cancel</span>(<span class="ruby-identifier">q_string</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-ivar">@serach_result</span> = <span class="ruby-constant">WorkFlow</span>.<span class="ruby-identifier">search_exclude_cancel_and_complete</span>(<span class="ruby-identifier">q_string</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-show_all_db" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">show_all_db</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <ul><li>
<p><strong>Description</strong> :</p>
<ul><li>
<p>It gets all data of lxs objects and render pop-up via show_all_db.js.erb</p>
</li></ul>
</li></ul>
          
          

          
          <div class="method-source-code" id="show_all_db-source">
            <pre><span class="ruby-comment"># File app/controllers/overview_controller.rb, line 1052</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">show_all_db</span>
  <span class="ruby-identifier">session</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:filter_object_id</span>)
  <span class="ruby-identifier">session</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:filter_object_type</span>)
  <span class="ruby-identifier">session</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:new_object_added</span>)
  <span class="ruby-identifier">session</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:include_canceled</span>)
  <span class="ruby-identifier">session</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:include_completed</span>)
  <span class="ruby-ivar">@label_attributes</span> = <span class="ruby-ivar">@workflow</span>.<span class="ruby-identifier">label_attributes</span>.<span class="ruby-identifier">order</span>(<span class="ruby-value">:sequence</span>) <span class="ruby-comment">#.where(is_visible: true)</span>
  <span class="ruby-ivar">@workflow_stations</span> = <span class="ruby-ivar">@workflow</span>.<span class="ruby-identifier">workflow_stations</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">is_visible</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>).<span class="ruby-identifier">order</span>(<span class="ruby-value">:sequence</span>)
  <span class="ruby-ivar">@workflows</span> = <span class="ruby-constant">WorkFlow</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">is_active</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>, <span class="ruby-identifier">is_in_use</span><span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>)
  <span class="ruby-ivar">@l1s</span> = <span class="ruby-ivar">@workflow</span>.<span class="ruby-identifier">l1s</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">status</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;Active&#39;</span>).<span class="ruby-identifier">order</span>(<span class="ruby-value">:id</span>)
  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>
  <span class="ruby-keyword">end</span> 
  
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-update_task_confirmation" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">update_task_confirmation</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <ul><li>
<p><strong>Description</strong> :</p>
<ul><li>
<p>It creates information for Task Confirmation of a Station Step, calculate
ETA&#39;s and then creates respective Additional Information.</p>
</li></ul>
</li></ul>
          
          

          
          <div class="method-source-code" id="update_task_confirmation-source">
            <pre><span class="ruby-comment"># File app/controllers/overview_controller.rb, line 1097</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">update_task_confirmation</span>
  <span class="ruby-identifier">session</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:open_confirm_modal</span>)
  <span class="ruby-identifier">actualConfirmation</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:workflow_live_step</span>][<span class="ruby-value">:actual_confirmation</span>]
  <span class="ruby-identifier">actual_confirmation</span> = <span class="ruby-constant">L1</span>.<span class="ruby-identifier">set_db_datetime_format</span>(<span class="ruby-identifier">actualConfirmation</span>)
  <span class="ruby-identifier">workflow_live_step</span> = <span class="ruby-constant">WorkflowLiveStep</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>])
  <span class="ruby-identifier">calculate_eta_completion</span>(<span class="ruby-identifier">actual_confirmation</span>, <span class="ruby-identifier">workflow_live_step</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">workflow_live_step</span>.<span class="ruby-identifier">object</span>.<span class="ruby-identifier">status</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&#39;active&#39;</span>
    <span class="ruby-identifier">workflow_live_step</span>.<span class="ruby-identifier">object</span>.<span class="ruby-identifier">update</span>(<span class="ruby-value">:status</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;Active&#39;</span>)
    <span class="ruby-constant">AdditionalInfo</span>.<span class="ruby-identifier">create</span>(<span class="ruby-identifier">object_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">workflow_live_step</span>.<span class="ruby-identifier">object_id</span>, <span class="ruby-identifier">object_type</span><span class="ruby-operator">:</span> <span class="ruby-identifier">workflow_live_step</span>.<span class="ruby-identifier">object_type</span>, <span class="ruby-identifier">status</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;Active&#39;</span>, <span class="ruby-identifier">work_flow_id</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@workflow</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">user_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">id</span>)
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">root_path</span>, <span class="ruby-identifier">notice</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;Step confirmation done&#39;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-update_workflow" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">update_workflow</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <ul><li>
<p><strong>Description</strong> :</p>
<ul><li>
<p>It finds Stations and thier Steps for current lxs and then renders Update
Workflow pop-up via update_workflow.js.erb</p>
</li></ul>
</li></ul>
          
          

          
          <div class="method-source-code" id="update_workflow-source">
            <pre><span class="ruby-comment"># File app/controllers/overview_controller.rb, line 233</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">update_workflow</span>
  <span class="ruby-ivar">@object_type</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:object_type</span>]
  <span class="ruby-ivar">@object_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:object_id</span>]
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@object_type</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;L1&#39;</span>
    <span class="ruby-ivar">@object</span> = <span class="ruby-constant">L1</span>.<span class="ruby-identifier">find</span>(<span class="ruby-ivar">@object_id</span>)
  <span class="ruby-keyword">elsif</span> <span class="ruby-ivar">@object_type</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;L2&#39;</span> 
    <span class="ruby-ivar">@object</span> = <span class="ruby-constant">L2</span>.<span class="ruby-identifier">find</span>(<span class="ruby-ivar">@object_id</span>)
  <span class="ruby-keyword">elsif</span> <span class="ruby-ivar">@object_type</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;L3&#39;</span> 
    <span class="ruby-ivar">@object</span> = <span class="ruby-constant">L3</span>.<span class="ruby-identifier">find</span>(<span class="ruby-ivar">@object_id</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-comment">#  @live_station_steps = WorkflowLiveStep.where(object_type: @object_type, object_id: @object_id)</span>
  <span class="ruby-ivar">@live_station_steps</span> = <span class="ruby-constant">WorkflowLiveStep</span>.<span class="ruby-identifier">joins</span>(<span class="ruby-value">:station_step</span>).<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;workflow_live_steps.object_type= &#39;#{@object_type}&#39; and workflow_live_steps.object_id = #{@object_id} and station_steps.can_be_turned_off = #{true} &quot;</span>)
  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-update_workflow_status" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">update_workflow_status</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <ul><li>
<p><strong>Description</strong> :</p>
<ul><li>
<p>It finds information for Task Confirmation of a Station Step and renders a
pop-up it via open_confirm_modal.js.erb</p>
</li></ul>
</li></ul>
          
          

          
          <div class="method-source-code" id="update_workflow_status-source">
            <pre><span class="ruby-comment"># File app/controllers/overview_controller.rb, line 836</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">update_workflow_status</span>
  <span class="ruby-identifier">workflow_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:workflow_id</span>]
  <span class="ruby-constant">WorkFlow</span>.<span class="ruby-identifier">update_all</span>(<span class="ruby-identifier">is_in_use</span><span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>)
  <span class="ruby-constant">WorkFlow</span>.<span class="ruby-identifier">update</span>(<span class="ruby-identifier">workflow_id</span>, <span class="ruby-identifier">is_in_use</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>)
  <span class="ruby-identifier">session</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:q_string</span>)
  <span class="ruby-identifier">session</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:wildcard</span>)
  <span class="ruby-identifier">session</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:exact</span>)
  <span class="ruby-identifier">session</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:filter_object_id</span>)
  <span class="ruby-identifier">session</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:filter_object_type</span>)
  <span class="ruby-identifier">session</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:new_object_added</span>)
  <span class="ruby-identifier">session</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:include_canceled</span>)
  <span class="ruby-identifier">session</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:include_completed</span>)

  <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">root_path</span>, <span class="ruby-identifier">notice</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;WorkFlow was successfully changed.&#39;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-workflow_update" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">workflow_update</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <ul><li>
<p><strong>Description</strong> :</p>
<ul><li>
<p>It updates Stations and thier steps for current lx&#39;s</p>
</li></ul>
</li></ul>
          
          

          
          <div class="method-source-code" id="workflow_update-source">
            <pre><span class="ruby-comment"># File app/controllers/overview_controller.rb, line 254</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">workflow_update</span>
  <span class="ruby-identifier">live_steps</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:live_steps</span>]
  <span class="ruby-identifier">object_type</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:object_type</span>]
  <span class="ruby-identifier">object_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:object_id</span>]

  <span class="ruby-constant">WorkflowLiveStep</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">object_type</span><span class="ruby-operator">:</span> <span class="ruby-identifier">object_type</span>, <span class="ruby-identifier">object_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">object_id</span>).<span class="ruby-identifier">update_all</span>(<span class="ruby-identifier">is_active</span><span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">live_steps</span>.<span class="ruby-identifier">present?</span>
    <span class="ruby-identifier">live_steps</span> = <span class="ruby-identifier">live_steps</span>.<span class="ruby-identifier">flatten</span>
    <span class="ruby-constant">WorkflowLiveStep</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">live_steps</span>).<span class="ruby-identifier">update_all</span>(<span class="ruby-identifier">is_active</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>)
    <span class="ruby-identifier">na_workflowlivestep</span> = <span class="ruby-constant">WorkflowLiveStep</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">object_type</span><span class="ruby-operator">:</span> <span class="ruby-identifier">object_type</span>, <span class="ruby-identifier">object_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">object_id</span>, <span class="ruby-identifier">is_active</span><span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>)
    <span class="ruby-identifier">na_workflowlivestep</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">na_step</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">na_step</span>.<span class="ruby-identifier">update</span>(<span class="ruby-identifier">actual_confirmation</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>)
      <span class="ruby-constant">TimestampLog</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">workflow_live_step_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">na_step</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">destroy_all</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>  
  <span class="ruby-identifier">workflowLiveStep</span> = <span class="ruby-constant">WorkflowLiveStep</span>.<span class="ruby-identifier">find_by_object_type_and_object_id</span>(<span class="ruby-identifier">object_type</span>, <span class="ruby-identifier">object_id</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">workflowLiveStep</span>.<span class="ruby-identifier">present?</span>
    <span class="ruby-constant">WorkflowLiveStep</span>.<span class="ruby-identifier">get_steps_calculate_eta</span>(<span class="ruby-identifier">workflowLiveStep</span>, <span class="ruby-ivar">@workflow</span>,<span class="ruby-identifier">current_user</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">root_path</span>, <span class="ruby-identifier">notice</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;Workflow Updated&#39;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://docs.seattlerb.org/rdoc/">RDoc</a> 4.2.2.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

